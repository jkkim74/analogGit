<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skplanet.bisportal.repository.ocb.RtdDauRepository">
    <select id="getVisitFstForPivotPerDay" parameterType="JqGridRequest" resultType="ObsVstFstUvSta">
        <![CDATA[
        WITH t AS (SELECT TO_CHAR(TO_DATE(STD_DT,'YYYYMMDD'),'YYYY-MM-DD')||'('||TO_CHAR(TO_DATE(STD_DT,'yyyymmdd'),'dy')||')' AS STRD_DT
                        , ALL_VST_CNT
                        , NEW_VST_CNT
                        , PRE_M_VST_CNT
                        , RE_VST_CNT
                     FROM OBS_D_VST_FST_UV_STA
                    WHERE STD_DT BETWEEN #{startDate} AND #{endDate}
                    ORDER BY STD_DT
                  )
        SELECT STRD_DT
             , DECODE (MEASURE
                       , 'ALL_VST_CNT','01월 최초 방문 전체'
                       , 'NEW_VST_CNT','02&nbsp;&nbsp;&nbsp;&nbsp;New visitor'
                       , 'PRE_M_VST_CNT','03&nbsp;&nbsp;&nbsp;&nbsp;전월고객'
                       , 'RE_VST_CNT','04&nbsp;&nbsp;&nbsp;&nbsp;휴면고객'
               ) AS MEASURE
             , MEASURE_VALUE
          FROM t UNPIVOT (MEASURE_VALUE FOR MEASURE
                                         IN (ALL_VST_CNT
                                             , NEW_VST_CNT
                                             , PRE_M_VST_CNT
                                             , RE_VST_CNT
                                            )
                         )
        ]]>
    </select>
</mapper>
