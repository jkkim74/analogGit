<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skplanet.bisportal.repository.ocb.ObsVstRsltnStaRepository">

    <select id="getVisitorsRsltnPerDay" parameterType="JqGridRequest" resultType="ObsVstRsltnSta">
        WITH t AS
        (
            SELECT
                '@'||scrn_rsltn AS scrn_rsltn,
                TO_CHAR(TO_DATE(std_dt,'YYYYMMDD'),'YYYY-MM-DD')||'('||TO_CHAR(to_Date(std_dt,'yyyymmdd'),'dy')||')' as std_dt,
                uv as uv,
                lv as lv,
                vst_cnt as vst_cnt,
                pv as pv
            FROM obs_d_vst_rsltn_sta
            WHERE
                (std_dt between #{startDate} and #{endDate})
                AND poc_ind_cd = '01'
            ORDER BY std_dt, scrn_rsltn
        )
        SELECT scrn_rsltn, std_dt, DECODE(measure, 'UV', '1UV', 'LV', '2LV (login visitor)','VST_CNT', '3방문횟수','PV', '4PV') AS measure, measure_value
        FROM   t
        UNPIVOT (measure_value FOR measure IN (uv, lv, vst_cnt, pv))
    </select>

    <select id="getVisitorsRsltnPerWeek" parameterType="JqGridRequest" resultType="ObsVstRsltnSta">
        WITH t AS
        (
            SELECT
                '@'||scrn_rsltn AS scrn_rsltn,
                TO_CHAR(TO_DATE(std_dt,'YYYYMMDD'),'YYYY-MM-DD')||'('||TO_CHAR(to_Date(std_dt,'yyyymmdd'),'dy')||')' as std_dt,
                uv as uv,
                lv as lv,
                vst_cnt as vst_cnt,
                pv as pv
            FROM obs_w_vst_rsltn_sta
            WHERE
                (std_dt <include refid="ObsCommonMapper.betweenStartDateAndEndDatePerWeek" />)
                AND poc_ind_cd = '01'
            ORDER BY std_dt, scrn_rsltn
        )
        SELECT scrn_rsltn, std_dt, DECODE(measure, 'UV', '1UV', 'LV', '2LV (login visitor)','VST_CNT', '3방문횟수','PV', '4PV') AS measure, measure_value
        FROM   t
        UNPIVOT (measure_value FOR measure IN (uv, lv, vst_cnt, pv))
    </select>

    <select id="getVisitorsRsltnPerMonth" parameterType="JqGridRequest" resultType="ObsVstRsltnSta">
        WITH t AS
        (
            SELECT
                '@'||scrn_rsltn AS scrn_rsltn,
                TO_CHAR(TO_DATE(std_ym,'YYYYMM'),'YYYY-MM') as std_dt,
                uv as uv,
                lv as lv,
                vst_cnt as vst_cnt,
                pv as pv
                FROM obs_m_vst_rsltn_sta
            WHERE
                (std_ym between #{startDate} and #{endDate})
                AND poc_ind_cd = '01'
            ORDER BY std_ym, scrn_rsltn
        )
        SELECT scrn_rsltn, std_dt, DECODE(measure, 'UV', '1UV', 'LV', '2LV (login visitor)','VST_CNT', '3방문횟수','PV', '4PV') AS measure, measure_value
        FROM   t
        UNPIVOT (measure_value FOR measure IN (uv, lv, vst_cnt, pv))
    </select>

</mapper>
