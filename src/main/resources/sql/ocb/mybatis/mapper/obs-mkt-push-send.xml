<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skplanet.bisportal.repository.ocb.ObsMktPushSendRepository">
    <select id="getMarketingPush" parameterType="JqGridRequest" resultType="ObsMktPushSend">
        SELECT TO_CHAR(TO_DATE(STD_DT, 'YYYYMMDD'), 'YYYY-MM-DD')|| '('|| TO_CHAR(TO_DATE(STD_DT, 'yyyymmdd'), 'dy')|| ')' AS STD_DT
             , '0' AS ORDER_IDX
             , SND_TIME || ':00' AS SND_TIME
             , TITLE
             , MSG
             , PUSH_TYPE
             , DISPLAY_TYPE
             , EVENT_ID
             , BIG_PICTURE
             , CUST_CNT
             , PUSH_RCV_CUST_CNT
             , PUSH_CLK_CUST_CNT
             , NOTI_CLK_CUST_CNT
             , DIRT_CLK_CNT
             , CLK_SUM
             , RCV_PER
             , RAT_PER
          FROM OBS_D_MKT_PUSH_SEND
         WHERE STD_DT BETWEEN #{startDate} AND #{endDate}
        UNION ALL
        SELECT TO_CHAR(TO_DATE(STD_DT, 'YYYYMMDD'), 'YYYY-MM-DD')|| '('|| TO_CHAR(TO_DATE(STD_DT, 'yyyymmdd'), 'dy')|| ')' AS STD_DT
             , '1' AS ORDER_IDX
             , '_SUMMARY' AS SND_TIME
             , '' AS TITLE
             , '' AS MSG
             , '' AS PUSH_TYPE
             , '' AS DISPLAY_TYPE
             , '' AS EVENT_ID
             , '' AS BIG_PICTURE
             , SUM(CUST_CNT) AS CUST_CNT
             , SUM(PUSH_RCV_CUST_CNT) AS PUSH_RCV_CUST_CNT
             , SUM(PUSH_CLK_CUST_CNT) AS PUSH_CLK_CUST_CNT
             , SUM(NOTI_CLK_CUST_CNT) AS NOTI_CLK_CUST_CNT
             , SUM(DIRT_CLK_CNT) AS DIRT_CLK_CNT
             , SUM(CLK_SUM) AS CLK_SUM
             , ROUND(SUM(PUSH_RCV_CUST_CNT) / SUM(CUST_CNT) * 100, 0) AS RCV_PER
             , ROUND(SUM(CLK_SUM) / SUM(CUST_CNT) * 100, 0) AS RAT_PER
          FROM OBS_D_MKT_PUSH_SEND
         WHERE STD_DT BETWEEN #{startDate} AND #{endDate}
         GROUP BY STD_DT
         ORDER BY STD_DT, ORDER_IDX, SND_TIME, TITLE, MSG ASC
    </select>
</mapper>
