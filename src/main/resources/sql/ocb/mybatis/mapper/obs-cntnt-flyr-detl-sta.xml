<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skplanet.bisportal.repository.ocb.ObsCntntFlyrDetlStaRepository">
    <select id="getStoreFlyerInTradeAreaFlyerForPivotPerDay" parameterType="JqGridRequest" resultType="ObsCntntFlyrDetlSta">
       SELECT TO_CHAR (TO_DATE (std_dt, 'YYYYMMDD'), 'YYYY-MM-DD')|| '('|| TO_CHAR (TO_DATE (std_dt, 'yyyymmdd'), 'dy')|| ')' AS std_dt,
              PUSH_GRP_ID AS PUSH_GRP_ID,
              GRP_ID AS GRP_ID,
              TO_CHAR (TO_DATE (SND_START_DT, 'YYYYMMDD'), 'YYYY.MM.DD') AS SND_START_DT,
              TO_CHAR (TO_DATE (SND_END_DT, 'YYYYMMDD'), 'YYYY.MM.DD') AS SND_END_DT,
              FLYR_ID AS FLYR_ID,
              STORE_NM AS STORE_NM,
              <if test="measureCode != null and measureCode.equals('UV')">
                  NVL(CLICK_CNT_ON_UV, 0) as measureValue
              </if>
              <if test="measureCode != null and measureCode.equals('LV')">
                  NVL(CLICK_CNT_ON_LV, 0) as measureValue
              </if>
              <if test="measureCode != null and measureCode.equals('PV')">
                  NVL(CLICK_CNT_ON_PV, 0) as measureValue
              </if>
         FROM OBS_D_CNTNT_FLYR_DETL_STA
        WHERE std_dt BETWEEN #{startDate} AND #{endDate}
          AND poc_ind_cd = '01'
     ORDER BY PUSH_GRP_ID,
              GRP_ID,
              SND_START_DT,
              SND_END_DT,
              FLYR_ID,
              STORE_NM
    </select>
    <select id="getStoreFlyerInTradeAreaFlyerForPivotPerWeek" parameterType="JqGridRequest" resultType="ObsCntntFlyrDetlSta">
       SELECT TO_CHAR (TO_DATE (std_dt, 'YYYYMMDD'), 'YYYY-MM-DD')|| '('|| TO_CHAR (TO_DATE (std_dt, 'yyyymmdd'), 'dy')|| ')' AS std_dt,
              PUSH_GRP_ID AS PUSH_GRP_ID,
              GRP_ID AS GRP_ID,
              TO_CHAR (TO_DATE (SND_START_DT, 'YYYYMMDD'), 'YYYY.MM.DD') AS SND_START_DT,
              TO_CHAR (TO_DATE (SND_END_DT, 'YYYYMMDD'), 'YYYY.MM.DD') AS SND_END_DT,
              FLYR_ID AS FLYR_ID,
              STORE_NM AS STORE_NM,
              <if test="measureCode != null and measureCode.equals('UV')">
                  NVL(CLICK_CNT_ON_UV, 0) as measureValue
              </if>
              <if test="measureCode != null and measureCode.equals('LV')">
                  NVL(CLICK_CNT_ON_LV, 0) as measureValue
              </if>
              <if test="measureCode != null and measureCode.equals('PV')">
                  NVL(CLICK_CNT_ON_PV, 0) as measureValue
              </if>
         FROM OBS_W_CNTNT_FLYR_DETL_STA
        WHERE (std_dt <include refid="ObsCommonMapper.betweenStartDateAndEndDatePerWeek" />)
          AND poc_ind_cd = '01'
     ORDER BY PUSH_GRP_ID,
              GRP_ID,
              SND_START_DT,
              SND_END_DT,
              FLYR_ID,
              STORE_NM
    </select>
    <select id="getStoreFlyerInTradeAreaFlyerForPivotPerMonth" parameterType="JqGridRequest" resultType="ObsCntntFlyrDetlSta">
      SELECT TO_CHAR (TO_DATE (std_ym, 'YYYYMM'), 'YYYY-MM') AS std_dt,
              PUSH_GRP_ID AS PUSH_GRP_ID,
              GRP_ID AS GRP_ID,
              TO_CHAR (TO_DATE (SND_START_DT, 'YYYYMMDD'), 'YYYY.MM.DD') AS SND_START_DT,
              TO_CHAR (TO_DATE (SND_END_DT, 'YYYYMMDD'), 'YYYY.MM.DD') AS SND_END_DT,
              FLYR_ID AS FLYR_ID,
              STORE_NM AS STORE_NM,
              <if test="measureCode != null and measureCode.equals('UV')">
                  NVL(CLICK_CNT_ON_UV, 0) as measureValue
              </if>
              <if test="measureCode != null and measureCode.equals('LV')">
                  NVL(CLICK_CNT_ON_LV, 0) as measureValue
              </if>
              <if test="measureCode != null and measureCode.equals('PV')">
                  NVL(CLICK_CNT_ON_PV, 0) as measureValue
              </if>
         FROM OBS_M_CNTNT_FLYR_DETL_STA
        WHERE std_ym BETWEEN #{startDate} AND #{endDate}
          AND poc_ind_cd = '01'
     ORDER BY PUSH_GRP_ID,
              GRP_ID,
              SND_START_DT,
              SND_END_DT,
              FLYR_ID,
              STORE_NM
    </select>
</mapper>
