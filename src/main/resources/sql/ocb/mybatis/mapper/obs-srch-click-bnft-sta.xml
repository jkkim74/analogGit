<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skplanet.bisportal.repository.ocb.ObsSrchClickBnftStaRepository">
    <select id="getSearchResultClickBnftPerDay" parameterType="JqGridRequest" resultType="ObsSrchClickBnftSta">
        SELECT std_dt, rowNumber, bnft_typ, bnft_id, bnft_name, click_cnt
        FROM (
            SELECT TO_CHAR(TO_DATE(b.std_dt,'YYYYMMDD'),'YYYY-MM-DD')||'('||TO_CHAR(to_Date(b.std_dt,'yyyymmdd'),'dy')||')' as std_dt, b.bnft_typ, b.bnft_id, t.name as bnft_name, b.click_cnt,
            RANK() OVER(PARTITION BY b.std_dt ORDER BY b.click_cnt DESC) ranking, ROW_NUMBER() OVER(PARTITION BY b.std_dt ORDER BY b.click_cnt DESC) rowNumber
            FROM   obs_d_srch_click_bnft_sta b, tmp_bnft_info t
            WHERE  b.bnft_id = t.id
            AND    b.std_dt BETWEEN #{startDate} AND #{endDate}
            AND b.poc_ind_cd = '01'
        )
        WHERE rowNumber &lt;= 100
        <if test="sidx == 'stdDt'">
            ORDER BY std_dt ${sord}, rowNumber
        </if>
    </select>
    <select id="getSearchResultClickBnftPerWeek" parameterType="JqGridRequest" resultType="ObsSrchClickBnftSta">
        SELECT std_dt, rowNumber, bnft_typ, bnft_id, bnft_name, click_cnt
        FROM (
            SELECT TO_CHAR(TO_DATE(b.std_dt,'YYYYMMDD'),'YYYY-MM-DD')||'('||TO_CHAR(to_Date(b.std_dt,'yyyymmdd'),'dy')||')' as std_dt, b.bnft_typ, b.bnft_id, t.name as bnft_name, b.click_cnt,
            RANK() OVER(PARTITION BY b.std_dt ORDER BY b.click_cnt DESC) ranking, ROW_NUMBER() OVER(PARTITION BY b.std_dt ORDER BY b.click_cnt DESC) rowNumber
            FROM   obs_d_srch_click_bnft_sta b, tmp_bnft_info t
            WHERE  b.bnft_id = t.id
            AND    b.std_dt <include refid="ObsCommonMapper.betweenStartDateAndEndDatePerWeek" />
            AND b.poc_ind_cd = '01'
        )
        WHERE rowNumber &lt;= 100
        <if test="sidx == 'stdDt'">
            ORDER BY std_dt ${sord}, rowNumber
        </if>
    </select>
    <select id="getSearchResultClickBnftPerMonth" parameterType="JqGridRequest" resultType="ObsSrchClickBnftSta">
        SELECT std_dt, rowNumber, bnft_typ, bnft_id, bnft_name, click_cnt
        FROM (
            SELECT substr (b.std_ym, 0, 4) || '-' || substr (b.std_ym, 5, 2) as std_dt, b.bnft_typ, b.bnft_id, t.name as bnft_name, b.click_cnt,
            RANK() OVER(PARTITION BY b.std_ym ORDER BY b.click_cnt DESC) ranking, ROW_NUMBER() OVER(PARTITION BY b.std_ym ORDER BY b.click_cnt DESC) rowNumber
            FROM   obs_m_srch_click_bnft_sta b, tmp_bnft_info t
            WHERE  b.bnft_id = t.id
            AND    b.std_ym BETWEEN #{startDate} AND #{endDate}
            AND b.poc_ind_cd = '01'
        )
        WHERE rowNumber &lt;= 100
        <if test="sidx == 'stdDt'">
            ORDER BY std_dt ${sord}, rowNumber
        </if>
    </select>
</mapper>
