<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skplanet.bisportal.repository.ocb.ObsCntntDscvStaRepository">
    <select id="getDiscoverForPivotPerDay" parameterType="JqGridRequest" resultType="ObsCntntDscvSta">
        WITH typeT
             AS (SELECT 'EXPSR_CNT' code, '01노출' TYPE FROM DUAL
                 UNION ALL
                 SELECT 'CLICK_CNT' code, '01클릭' TYPE FROM DUAL
                 UNION ALL
                 SELECT 'CLICK_COPN_CNT' code, '01클릭' TYPE FROM DUAL
                 UNION ALL
                 SELECT 'CLICK_PTRN_CNT' code, '01클릭' TYPE FROM DUAL
                 UNION ALL
                 SELECT 'CLICK_STAR_CNT' code, '01클릭' TYPE FROM DUAL
                 UNION ALL
                 SELECT 'CLICK_MBIL_FLYR_CNT' code, '01클릭' TYPE FROM DUAL)
         ,t1 AS (SELECT    TO_CHAR (TO_DATE (std_dt, 'YYYYMMDD'), 'YYYY-MM-DD')|| '('|| TO_CHAR (TO_DATE (std_dt, 'yyyymmdd'), 'dy')|| ')' AS std_dt,
                        '01UV' AS mainCategory,
                        EXPSR_CNT_ON_UV AS EXPSR_CNT,
                        CLICK_CNT_ON_UV AS CLICK_CNT,
                        CLICK_COPN_CNT_ON_UV AS CLICK_COPN_CNT,
                        CLICK_PTRN_CNT_ON_UV AS CLICK_PTRN_CNT,
                        CLICK_STAR_CNT_ON_UV AS CLICK_STAR_CNT,
                        CLICK_MBIL_FLYR_CNT_ON_UV AS CLICK_MBIL_FLYR_CNT
                   FROM obs_d_cntnt_dscv_sta
                  WHERE std_dt BETWEEN #{startDate} AND #{endDate}
                    AND poc_ind_cd = '01'
                 UNION ALL
                 SELECT    TO_CHAR (TO_DATE (std_dt, 'YYYYMMDD'), 'YYYY-MM-DD')|| '('|| TO_CHAR (TO_DATE (std_dt, 'yyyymmdd'), 'dy')|| ')' AS std_dt,
                        '02LV' AS mainCategory,
                        EXPSR_CNT_ON_LV AS EXPSR_CNT,
                        CLICK_CNT_ON_LV AS CLICK_CNT,
                        CLICK_COPN_CNT_ON_LV AS CLICK_COPN_CNT,
                        CLICK_PTRN_CNT_ON_LV AS CLICK_PTRN_CNT,
                        CLICK_STAR_CNT_ON_LV AS CLICK_STAR_CNT,
                        CLICK_MBIL_FLYR_CNT_ON_LV AS CLICK_MBIL_FLYR_CNT
                   FROM obs_d_cntnt_dscv_sta
                  WHERE std_dt BETWEEN #{startDate} AND #{endDate}
                    AND poc_ind_cd = '01'
                 UNION ALL
                 SELECT    TO_CHAR (TO_DATE (std_dt, 'YYYYMMDD'), 'YYYY-MM-DD')|| '('|| TO_CHAR (TO_DATE (std_dt, 'yyyymmdd'), 'dy')|| ')' AS std_dt,
                        '03횟수' AS mainCategory,
                        EXPSR_CNT AS EXPSR_CNT,
                        CLICK_CNT AS CLICK_CNT,
                        CLICK_COPN_CNT AS CLICK_COPN_CNT,
                        CLICK_PTRN_CNT AS CLICK_PTRN_CNT,
                        CLICK_STAR_CNT AS CLICK_STAR_CNT,
                        CLICK_MBIL_FLYR_CNT AS CLICK_MBIL_FLYR_CNT
                   FROM obs_d_cntnt_dscv_sta
                  WHERE std_dt BETWEEN #{startDate} AND #{endDate}
                    AND poc_ind_cd = '01')
        SELECT std_dt,
               mainCategory,
               typeT.TYPE subCategory,
               DECODE (measure,
                       'EXPSR_CNT', '01디스커버 아이콘',
                       'CLICK_CNT', '02디스커버 아이콘',
                       'CLICK_COPN_CNT', '03내쿠폰 아이콘',
                       'CLICK_PTRN_CNT', '04단골매장 아이콘',
                       'CLICK_STAR_CNT', '05스타 아이콘',
                       'CLICK_MBIL_FLYR_CNT', '06모바일전단 아이콘')
                  AS measure,
               measureValue
          FROM t1 UNPIVOT (measureValue
                  FOR measure
                  IN  (EXPSR_CNT,
                      CLICK_CNT,
                      CLICK_COPN_CNT,
                      CLICK_PTRN_CNT,
                      CLICK_STAR_CNT,
                      CLICK_MBIL_FLYR_CNT)),
               typeT
         WHERE measure = typeT.code
    </select>
    <select id="getDiscoverForPivotPerWeek" parameterType="JqGridRequest" resultType="ObsCntntDscvSta">
        WITH typeT
             AS (SELECT 'EXPSR_CNT' code, '01노출' TYPE FROM DUAL
                 UNION ALL
                 SELECT 'CLICK_CNT' code, '01클릭' TYPE FROM DUAL
                 UNION ALL
                 SELECT 'CLICK_COPN_CNT' code, '01클릭' TYPE FROM DUAL
                 UNION ALL
                 SELECT 'CLICK_PTRN_CNT' code, '01클릭' TYPE FROM DUAL
                 UNION ALL
                 SELECT 'CLICK_STAR_CNT' code, '01클릭' TYPE FROM DUAL
                 UNION ALL
                 SELECT 'CLICK_MBIL_FLYR_CNT' code, '01클릭' TYPE FROM DUAL)
         ,t1 AS (SELECT    TO_CHAR (TO_DATE (std_dt, 'YYYYMMDD'), 'YYYY-MM-DD')|| '('|| TO_CHAR (TO_DATE (std_dt, 'yyyymmdd'), 'dy')|| ')' AS std_dt,
                        '01UV' AS mainCategory,
                        EXPSR_CNT_ON_UV AS EXPSR_CNT,
                        CLICK_CNT_ON_UV AS CLICK_CNT,
                        CLICK_COPN_CNT_ON_UV AS CLICK_COPN_CNT,
                        CLICK_PTRN_CNT_ON_UV AS CLICK_PTRN_CNT,
                        CLICK_STAR_CNT_ON_UV AS CLICK_STAR_CNT,
                        CLICK_MBIL_FLYR_CNT_ON_UV AS CLICK_MBIL_FLYR_CNT
                   FROM obs_w_cntnt_dscv_sta
                  WHERE (std_dt <include refid="ObsCommonMapper.betweenStartDateAndEndDatePerWeek" />)
                    AND poc_ind_cd = '01'
                 UNION ALL
                 SELECT    TO_CHAR (TO_DATE (std_dt, 'YYYYMMDD'), 'YYYY-MM-DD')|| '('|| TO_CHAR (TO_DATE (std_dt, 'yyyymmdd'), 'dy')|| ')' AS std_dt,
                        '02LV' AS mainCategory,
                        EXPSR_CNT_ON_LV AS EXPSR_CNT,
                        CLICK_CNT_ON_LV AS CLICK_CNT,
                        CLICK_COPN_CNT_ON_LV AS CLICK_COPN_CNT,
                        CLICK_PTRN_CNT_ON_LV AS CLICK_PTRN_CNT,
                        CLICK_STAR_CNT_ON_LV AS CLICK_STAR_CNT,
                        CLICK_MBIL_FLYR_CNT_ON_LV AS CLICK_MBIL_FLYR_CNT
                   FROM obs_w_cntnt_dscv_sta
                  WHERE (std_dt <include refid="ObsCommonMapper.betweenStartDateAndEndDatePerWeek" />)
                    AND poc_ind_cd = '01'
                 UNION ALL
                 SELECT    TO_CHAR (TO_DATE (std_dt, 'YYYYMMDD'), 'YYYY-MM-DD')|| '('|| TO_CHAR (TO_DATE (std_dt, 'yyyymmdd'), 'dy')|| ')' AS std_dt,
                        '03횟수' AS mainCategory,
                        EXPSR_CNT AS EXPSR_CNT,
                        CLICK_CNT AS CLICK_CNT,
                        CLICK_COPN_CNT AS CLICK_COPN_CNT,
                        CLICK_PTRN_CNT AS CLICK_PTRN_CNT,
                        CLICK_STAR_CNT AS CLICK_STAR_CNT,
                        CLICK_MBIL_FLYR_CNT AS CLICK_MBIL_FLYR_CNT
                   FROM obs_w_cntnt_dscv_sta
                  WHERE (std_dt <include refid="ObsCommonMapper.betweenStartDateAndEndDatePerWeek" />)
                    AND poc_ind_cd = '01')
        SELECT std_dt,
               mainCategory,
               typeT.TYPE subCategory,
               DECODE (measure,
                       'EXPSR_CNT', '01디스커버 아이콘',
                       'CLICK_CNT', '02디스커버 아이콘',
                       'CLICK_COPN_CNT', '03내쿠폰 아이콘',
                       'CLICK_PTRN_CNT', '04단골매장 아이콘',
                       'CLICK_STAR_CNT', '05스타 아이콘',
                       'CLICK_MBIL_FLYR_CNT', '06모바일전단 아이콘')
                  AS measure,
               measureValue
          FROM t1 UNPIVOT (measureValue
                  FOR measure
                  IN  (EXPSR_CNT,
                      CLICK_CNT,
                      CLICK_COPN_CNT,
                      CLICK_PTRN_CNT,
                      CLICK_STAR_CNT,
                      CLICK_MBIL_FLYR_CNT)),
               typeT
         WHERE measure = typeT.code
    </select>
    <select id="getDiscoverForPivotPerMonth" parameterType="JqGridRequest" resultType="ObsCntntDscvSta">
        WITH typeT
             AS (SELECT 'EXPSR_CNT' code, '01노출' TYPE FROM DUAL
                 UNION ALL
                 SELECT 'CLICK_CNT' code, '01클릭' TYPE FROM DUAL
                 UNION ALL
                 SELECT 'CLICK_COPN_CNT' code, '01클릭' TYPE FROM DUAL
                 UNION ALL
                 SELECT 'CLICK_PTRN_CNT' code, '01클릭' TYPE FROM DUAL
                 UNION ALL
                 SELECT 'CLICK_STAR_CNT' code, '01클릭' TYPE FROM DUAL
                 UNION ALL
                 SELECT 'CLICK_MBIL_FLYR_CNT' code, '01클릭' TYPE FROM DUAL)
         ,t1 AS (SELECT    TO_CHAR (TO_DATE (std_ym, 'YYYYMM'), 'YYYY-MM') AS std_dt,
                        '01UV' AS mainCategory,
                        EXPSR_CNT_ON_UV AS EXPSR_CNT,
                        CLICK_CNT_ON_UV AS CLICK_CNT,
                        CLICK_COPN_CNT_ON_UV AS CLICK_COPN_CNT,
                        CLICK_PTRN_CNT_ON_UV AS CLICK_PTRN_CNT,
                        CLICK_STAR_CNT_ON_UV AS CLICK_STAR_CNT,
                        CLICK_MBIL_FLYR_CNT_ON_UV AS CLICK_MBIL_FLYR_CNT
                   FROM obs_m_cntnt_dscv_sta
                  WHERE std_ym BETWEEN #{startDate} AND #{endDate}
                    AND poc_ind_cd = '01'
                 UNION ALL
                 SELECT    TO_CHAR (TO_DATE (std_ym, 'YYYYMM'), 'YYYY-MM') AS std_dt,
                        '02LV' AS mainCategory,
                        EXPSR_CNT_ON_LV AS EXPSR_CNT,
                        CLICK_CNT_ON_LV AS CLICK_CNT,
                        CLICK_COPN_CNT_ON_LV AS CLICK_COPN_CNT,
                        CLICK_PTRN_CNT_ON_LV AS CLICK_PTRN_CNT,
                        CLICK_STAR_CNT_ON_LV AS CLICK_STAR_CNT,
                        CLICK_MBIL_FLYR_CNT_ON_LV AS CLICK_MBIL_FLYR_CNT
                   FROM obs_m_cntnt_dscv_sta
                  WHERE std_ym BETWEEN #{startDate} AND #{endDate}
                    AND poc_ind_cd = '01'
                 UNION ALL
                 SELECT    TO_CHAR (TO_DATE (std_ym, 'YYYYMM'), 'YYYY-MM') AS std_dt,
                        '03횟수' AS mainCategory,
                        EXPSR_CNT AS EXPSR_CNT,
                        CLICK_CNT AS CLICK_CNT,
                        CLICK_COPN_CNT AS CLICK_COPN_CNT,
                        CLICK_PTRN_CNT AS CLICK_PTRN_CNT,
                        CLICK_STAR_CNT AS CLICK_STAR_CNT,
                        CLICK_MBIL_FLYR_CNT AS CLICK_MBIL_FLYR_CNT
                   FROM obs_m_cntnt_dscv_sta
                  WHERE std_ym BETWEEN #{startDate} AND #{endDate}
                    AND poc_ind_cd = '01')
        SELECT std_dt,
               mainCategory,
               typeT.TYPE subCategory,
               DECODE (measure,
                       'EXPSR_CNT', '01디스커버 아이콘',
                       'CLICK_CNT', '02디스커버 아이콘',
                       'CLICK_COPN_CNT', '03내쿠폰 아이콘',
                       'CLICK_PTRN_CNT', '04단골매장 아이콘',
                       'CLICK_STAR_CNT', '05스타 아이콘',
                       'CLICK_MBIL_FLYR_CNT', '06모바일전단 아이콘')
                  AS measure,
               measureValue
          FROM t1 UNPIVOT (measureValue
                  FOR measure
                  IN  (EXPSR_CNT,
                      CLICK_CNT,
                      CLICK_COPN_CNT,
                      CLICK_PTRN_CNT,
                      CLICK_STAR_CNT,
                      CLICK_MBIL_FLYR_CNT)),
               typeT
         WHERE measure = typeT.code
    </select>
</mapper>
