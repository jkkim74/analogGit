<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skplanet.bisportal.repository.ocb.ObsActnStaRepository">
    <select id="getCustomersActionPerDay" parameterType="JqGridRequest" resultType="ObsActnSta">
        WITH t1
             AS (  SELECT TO_CHAR (TO_DATE (std_dt, 'YYYYMMDD'), 'YYYY-MM-DD')||'('|| TO_CHAR (TO_DATE (std_dt, 'yyyymmdd'), 'dy')|| ')' AS std_dt,
                          '01유저수' AS actnCategory,
                          chkin_user_cnt AS chkin_user_cnt,
                          call_user_cnt AS call_user_cnt,
                          photo_reg_user_cnt AS photo_reg_user_cnt,
                          review_reg_user_cnt AS review_reg_user_cnt,
                          shr_click_user_cnt AS shr_click_user_cnt,
                          prchs_click_user_cnt AS prchs_click_user_cnt,
                          prchs_cmpln_user_cnt AS prchs_cmpln_user_cnt,
                          presnt_click_user_cnt AS presnt_click_user_cnt,
                          presnt_cmpln_user_cnt AS presnt_cmpln_user_cnt,
                          dnld_click_user_cnt AS dnld_click_user_cnt,
                          dnld_cmpln_user_cnt AS dnld_cmpln_user_cnt,
                          feed_click_user_cnt AS feed_click_user_cnt,
                          ptrn_user_cnt AS ptrn_user_cnt,
                          star_user_cnt AS star_user_cnt
                     FROM obs_d_actn_sta
                    WHERE  std_dt BETWEEN #{startDate} AND #{endDate}
                    AND poc_ind_cd = '01'
                 UNION ALL
                   SELECT TO_CHAR (TO_DATE (std_dt, 'YYYYMMDD'), 'YYYY-MM-DD')||'('|| TO_CHAR (TO_DATE (std_dt, 'yyyymmdd'), 'dy')|| ')' AS std_dt,
                          '02누적유저수' AS actnCategory,
                          chkin_acm_user_cnt AS chkin_user_cnt,
                          call_acm_user_cnt AS call_user_cnt,
                          photo_reg_acm_user_cnt AS photo_reg_user_cnt,
                          review_reg_acm_user_cnt AS review_reg_user_cnt,
                          shr_click_acm_user_cnt AS shr_click_user_cnt,
                          prchs_click_acm_user_cnt AS prchs_click_user_cnt,
                          prchs_cmpln_acm_user_cnt AS prchs_cmpln_user_cnt,
                          presnt_click_acm_user_cnt AS presnt_click_user_cnt,
                          presnt_cmpln_acm_user_cnt AS presnt_cmpln_user_cnt,
                          dnld_click_acm_user_cnt AS dnld_click_user_cnt,
                          dnld_cmpln_acm_user_cnt AS dnld_cmpln_user_cnt,
                          feed_click_acm_user_cnt AS feed_click_user_cnt,
                          ptrn_acm_user_cnt AS ptrn_user_cnt,
                          star_acm_user_cnt AS star_user_cnt
                     FROM obs_d_actn_sta
                    WHERE  std_dt BETWEEN #{startDate} AND #{endDate}
                    AND poc_ind_cd = '01'
                 UNION ALL
                   SELECT TO_CHAR (TO_DATE (std_dt, 'YYYYMMDD'), 'YYYY-MM-DD')||'('|| TO_CHAR (TO_DATE (std_dt, 'yyyymmdd'), 'dy')|| ')' AS std_dt,
                          '03횟수' AS actnCategory,
                          chkin_cnt AS chkin_user_cnt,
                          call_cnt AS call_user_cnt,
                          photo_reg_cnt AS photo_reg_user_cnt,
                          review_reg_cnt AS review_reg_user_cnt,
                          shr_click_cnt AS shr_click_user_cnt,
                          prchs_click_cnt AS prchs_click_user_cnt,
                          prchs_cmpln_cnt AS prchs_cmpln_user_cnt,
                          presnt_click_cnt AS presnt_click_user_cnt,
                          presnt_cmpln_cnt AS presnt_cmpln_user_cnt,
                          dnld_click_cnt AS dnld_click_user_cnt,
                          dnld_cmpln_cnt AS dnld_cmpln_user_cnt,
                          feed_click_cnt AS feed_click_user_cnt,
                          ptrn_cnt AS ptrn_user_cnt,
                          0 AS star_user_cnt
                     FROM obs_d_actn_sta
                    WHERE  std_dt BETWEEN #{startDate} AND #{endDate}
                    AND poc_ind_cd = '01'
                 UNION ALL
                   SELECT TO_CHAR (TO_DATE (std_dt, 'YYYYMMDD'), 'YYYY-MM-DD')||'('|| TO_CHAR (TO_DATE (std_dt, 'yyyymmdd'), 'dy')|| ')' AS std_dt,
                          '04누적횟수' AS actnCategory,
                          chkin_acm_cnt AS chkin_user_cnt,
                          call_acm_cnt AS call_user_cnt,
                          photo_reg_acm_cnt AS photo_reg_user_cnt,
                          review_reg_acm_cnt AS review_reg_user_cnt,
                          shr_click_acm_cnt AS shr_click_user_cnt,
                          prchs_click_acm_cnt AS prchs_click_user_cnt,
                          prchs_cmpln_acm_cnt AS prchs_cmpln_user_cnt,
                          presnt_click_acm_cnt AS presnt_click_user_cnt,
                          presnt_cmpln_acm_cnt AS presnt_cmpln_user_cnt,
                          dnld_click_acm_cnt AS dnld_click_user_cnt,
                          dnld_cmpln_acm_cnt AS dnld_cmpln_user_cnt,
                          feed_click_acm_cnt AS feed_click_user_cnt,
                          ptrn_acm_cnt AS ptrn_user_cnt,
                          0 AS star_user_cnt
                     FROM obs_d_actn_sta
                    WHERE  std_dt BETWEEN #{startDate} AND #{endDate}
                    AND poc_ind_cd = '01'
                 )
        SELECT std_dt,
               actnCategory,
               DECODE (measure
                       ,'CHKIN_USER_CNT', '01체크인'
                       ,'CALL_USER_CNT', '02전화걸기 클릭'
                       ,'PHOTO_REG_USER_CNT', '03사진등록 완료'
                       ,'REVIEW_REG_USER_CNT', '04리뷰등록 완료'
--                        ,'SHR_CLICK_USER_CNT', '05공유'
                       ,'PRCHS_CLICK_USER_CNT', '06구매하기 버튼클릭'
                       ,'PRCHS_CMPLN_USER_CNT', '07구매완료'
                       ,'PRESNT_CLICK_USER_CNT', '08선물하기 버튼클릭'
                       ,'PRESNT_CMPLN_USER_CNT', '09선물완료'
                       ,'DNLD_CLICK_USER_CNT', '10다운로드 버튼클릭'
                       ,'DNLD_CMPLN_USER_CNT', '11다운로드 완료'
                       ,'FEED_CLICK_USER_CNT', '12피드 클릭'
                       ,'PTRN_USER_CNT', '13단골맺기'
--                        ,'STAR_USER_CNT', '14매장스타'
                  ) AS measure,
               measureValue
          FROM t1 UNPIVOT (measureValue
                  FOR measure
                  IN  (chkin_user_cnt
                      ,call_user_cnt
                      ,photo_reg_user_cnt
                      ,review_reg_user_cnt
--                       ,shr_click_user_cnt
                      ,prchs_click_user_cnt
                      ,prchs_cmpln_user_cnt
                      ,presnt_click_user_cnt
                      ,presnt_cmpln_user_cnt
                      ,dnld_click_user_cnt
                      ,dnld_cmpln_user_cnt
                      ,feed_click_user_cnt
                      ,ptrn_user_cnt
--                       ,star_user_cnt
                  ))
    </select>
    <select id="getCustomersActionPerWeek" parameterType="JqGridRequest" resultType="ObsActnSta">
        WITH t1
             AS (  SELECT TO_CHAR (TO_DATE (std_dt, 'YYYYMMDD'), 'YYYY-MM-DD')||'('|| TO_CHAR (TO_DATE (std_dt, 'yyyymmdd'), 'dy')|| ')' AS std_dt,
                          '01유저수' AS actnCategory,
                          chkin_user_cnt AS chkin_user_cnt,
                          call_user_cnt AS call_user_cnt,
                          photo_reg_user_cnt AS photo_reg_user_cnt,
                          review_reg_user_cnt AS review_reg_user_cnt,
                          shr_click_user_cnt AS shr_click_user_cnt,
                          prchs_click_user_cnt AS prchs_click_user_cnt,
                          prchs_cmpln_user_cnt AS prchs_cmpln_user_cnt,
                          presnt_click_user_cnt AS presnt_click_user_cnt,
                          presnt_cmpln_user_cnt AS presnt_cmpln_user_cnt,
                          dnld_click_user_cnt AS dnld_click_user_cnt,
                          dnld_cmpln_user_cnt AS dnld_cmpln_user_cnt,
                          feed_click_user_cnt AS feed_click_user_cnt,
                          ptrn_user_cnt AS ptrn_user_cnt,
                          star_user_cnt AS star_user_cnt
                     FROM obs_w_actn_sta
                    WHERE  std_dt BETWEEN #{startDate} AND #{endDate}
                    AND poc_ind_cd = '01'
                 UNION ALL
                   SELECT TO_CHAR (TO_DATE (std_dt, 'YYYYMMDD'), 'YYYY-MM-DD')||'('|| TO_CHAR (TO_DATE (std_dt, 'yyyymmdd'), 'dy')|| ')' AS std_dt,
                          '02누적유저수' AS actnCategory,
                          chkin_acm_user_cnt AS chkin_user_cnt,
                          call_acm_user_cnt AS call_user_cnt,
                          photo_reg_acm_user_cnt AS photo_reg_user_cnt,
                          review_reg_acm_user_cnt AS review_reg_user_cnt,
                          shr_click_acm_user_cnt AS shr_click_user_cnt,
                          prchs_click_acm_user_cnt AS prchs_click_user_cnt,
                          prchs_cmpln_acm_user_cnt AS prchs_cmpln_user_cnt,
                          presnt_click_acm_user_cnt AS presnt_click_user_cnt,
                          presnt_cmpln_acm_user_cnt AS presnt_cmpln_user_cnt,
                          dnld_click_acm_user_cnt AS dnld_click_user_cnt,
                          dnld_cmpln_acm_user_cnt AS dnld_cmpln_user_cnt,
                          feed_click_acm_user_cnt AS feed_click_user_cnt,
                          ptrn_acm_user_cnt AS ptrn_user_cnt,
                          star_acm_user_cnt AS star_user_cnt
                     FROM obs_w_actn_sta
                    WHERE  std_dt BETWEEN #{startDate} AND #{endDate}
                    AND poc_ind_cd = '01'
                 UNION ALL
                   SELECT TO_CHAR (TO_DATE (std_dt, 'YYYYMMDD'), 'YYYY-MM-DD')||'('|| TO_CHAR (TO_DATE (std_dt, 'yyyymmdd'), 'dy')|| ')' AS std_dt,
                          '03횟수' AS actnCategory,
                          chkin_cnt AS chkin_user_cnt,
                          call_cnt AS call_user_cnt,
                          photo_reg_cnt AS photo_reg_user_cnt,
                          review_reg_cnt AS review_reg_user_cnt,
                          shr_click_cnt AS shr_click_user_cnt,
                          prchs_click_cnt AS prchs_click_user_cnt,
                          prchs_cmpln_cnt AS prchs_cmpln_user_cnt,
                          presnt_click_cnt AS presnt_click_user_cnt,
                          presnt_cmpln_cnt AS presnt_cmpln_user_cnt,
                          dnld_click_cnt AS dnld_click_user_cnt,
                          dnld_cmpln_cnt AS dnld_cmpln_user_cnt,
                          feed_click_cnt AS feed_click_user_cnt,
                          ptrn_cnt AS ptrn_user_cnt,
                          0 AS star_user_cnt
                     FROM obs_w_actn_sta
                    WHERE  std_dt BETWEEN #{startDate} AND #{endDate}
                    AND poc_ind_cd = '01'
                 UNION ALL
                   SELECT TO_CHAR (TO_DATE (std_dt, 'YYYYMMDD'), 'YYYY-MM-DD')||'('|| TO_CHAR (TO_DATE (std_dt, 'yyyymmdd'), 'dy')|| ')' AS std_dt,
                          '04누적횟수' AS actnCategory,
                          chkin_acm_cnt AS chkin_user_cnt,
                          call_acm_cnt AS call_user_cnt,
                          photo_reg_acm_cnt AS photo_reg_user_cnt,
                          review_reg_acm_cnt AS review_reg_user_cnt,
                          shr_click_acm_cnt AS shr_click_user_cnt,
                          prchs_click_acm_cnt AS prchs_click_user_cnt,
                          prchs_cmpln_acm_cnt AS prchs_cmpln_user_cnt,
                          presnt_click_acm_cnt AS presnt_click_user_cnt,
                          presnt_cmpln_acm_cnt AS presnt_cmpln_user_cnt,
                          dnld_click_acm_cnt AS dnld_click_user_cnt,
                          dnld_cmpln_acm_cnt AS dnld_cmpln_user_cnt,
                          feed_click_acm_cnt AS feed_click_user_cnt,
                          ptrn_acm_cnt AS ptrn_user_cnt,
                          0 AS star_user_cnt
                     FROM obs_w_actn_sta
                    WHERE  std_dt  <include refid="ObsCommonMapper.betweenStartDateAndEndDatePerWeek" />
                    AND poc_ind_cd = '01'
                 )
        SELECT std_dt,
               actnCategory,
               DECODE (measure
                       ,'CHKIN_USER_CNT', '01체크인'
                       ,'CALL_USER_CNT', '02전화걸기 클릭'
                       ,'PHOTO_REG_USER_CNT', '03사진등록 완료'
                       ,'REVIEW_REG_USER_CNT', '04리뷰등록 완료'
--                        ,'SHR_CLICK_USER_CNT', '05공유'
                       ,'PRCHS_CLICK_USER_CNT', '06구매하기 버튼클릭'
                       ,'PRCHS_CMPLN_USER_CNT', '07구매완료'
                       ,'PRESNT_CLICK_USER_CNT', '08선물하기 버튼클릭'
                       ,'PRESNT_CMPLN_USER_CNT', '09선물완료'
                       ,'DNLD_CLICK_USER_CNT', '10다운로드 버튼클릭'
                       ,'DNLD_CMPLN_USER_CNT', '11다운로드 완료'
                       ,'FEED_CLICK_USER_CNT', '12피드 클릭'
                       ,'PTRN_USER_CNT', '13단골맺기'
--                        ,'STAR_USER_CNT', '14매장스타'
                  )  AS measure,
               measureValue
          FROM t1 UNPIVOT (measureValue
                  FOR measure
                  IN  (chkin_user_cnt
                      ,call_user_cnt
                      ,photo_reg_user_cnt
                      ,review_reg_user_cnt
--                       ,shr_click_user_cnt
                      ,prchs_click_user_cnt
                      ,prchs_cmpln_user_cnt
                      ,presnt_click_user_cnt
                      ,presnt_cmpln_user_cnt
                      ,dnld_click_user_cnt
                      ,dnld_cmpln_user_cnt
                      ,feed_click_user_cnt
                      ,ptrn_user_cnt
--                       ,star_user_cnt
                  ))
    </select>
    <select id="getCustomersActionPerMonth" parameterType="JqGridRequest" resultType="ObsActnSta">
        WITH t1
             AS (  SELECT TO_CHAR (TO_DATE (std_ym, 'YYYYMM'), 'YYYY-MM') AS std_dt,
                          '01유저수' AS actnCategory,
                          chkin_user_cnt AS chkin_user_cnt,
                          call_user_cnt AS call_user_cnt,
                          photo_reg_user_cnt AS photo_reg_user_cnt,
                          review_reg_user_cnt AS review_reg_user_cnt,
                          shr_click_user_cnt AS shr_click_user_cnt,
                          prchs_click_user_cnt AS prchs_click_user_cnt,
                          prchs_cmpln_user_cnt AS prchs_cmpln_user_cnt,
                          presnt_click_user_cnt AS presnt_click_user_cnt,
                          presnt_cmpln_user_cnt AS presnt_cmpln_user_cnt,
                          dnld_click_user_cnt AS dnld_click_user_cnt,
                          dnld_cmpln_user_cnt AS dnld_cmpln_user_cnt,
                          feed_click_user_cnt AS feed_click_user_cnt,
                          ptrn_user_cnt AS ptrn_user_cnt,
                          star_user_cnt AS star_user_cnt
                     FROM obs_m_actn_sta
                    WHERE  std_ym BETWEEN #{startDate} AND #{endDate}
                    AND poc_ind_cd = '01'
                 UNION ALL
                   SELECT TO_CHAR (TO_DATE (std_ym, 'YYYYMM'), 'YYYY-MM') AS std_dt,
                          '02누적유저수' AS actnCategory,
                          chkin_acm_user_cnt AS chkin_user_cnt,
                          call_acm_user_cnt AS call_user_cnt,
                          photo_reg_acm_user_cnt AS photo_reg_user_cnt,
                          review_reg_acm_user_cnt AS review_reg_user_cnt,
                          shr_click_acm_user_cnt AS shr_click_user_cnt,
                          prchs_click_acm_user_cnt AS prchs_click_user_cnt,
                          prchs_cmpln_acm_user_cnt AS prchs_cmpln_user_cnt,
                          presnt_click_acm_user_cnt AS presnt_click_user_cnt,
                          presnt_cmpln_acm_user_cnt AS presnt_cmpln_user_cnt,
                          dnld_click_acm_user_cnt AS dnld_click_user_cnt,
                          dnld_cmpln_acm_user_cnt AS dnld_cmpln_user_cnt,
                          feed_click_acm_user_cnt AS feed_click_user_cnt,
                          ptrn_acm_user_cnt AS ptrn_user_cnt,
                          star_acm_user_cnt AS star_user_cnt
                     FROM obs_m_actn_sta
                    WHERE  std_ym BETWEEN #{startDate} AND #{endDate}
                      AND poc_ind_cd = '01'
                 UNION ALL
                   SELECT TO_CHAR (TO_DATE (std_ym, 'YYYYMM'), 'YYYY-MM') AS std_dt,
                          '03횟수' AS actnCategory,
                          chkin_cnt AS chkin_user_cnt,
                          call_cnt AS call_user_cnt,
                          photo_reg_cnt AS photo_reg_user_cnt,
                          review_reg_cnt AS review_reg_user_cnt,
                          shr_click_cnt AS shr_click_user_cnt,
                          prchs_click_cnt AS prchs_click_user_cnt,
                          prchs_cmpln_cnt AS prchs_cmpln_user_cnt,
                          presnt_click_cnt AS presnt_click_user_cnt,
                          presnt_cmpln_cnt AS presnt_cmpln_user_cnt,
                          dnld_click_cnt AS dnld_click_user_cnt,
                          dnld_cmpln_cnt AS dnld_cmpln_user_cnt,
                          feed_click_cnt AS feed_click_user_cnt,
                          ptrn_cnt AS ptrn_user_cnt,
                          0 AS star_user_cnt
                     FROM obs_m_actn_sta
                    WHERE  std_ym BETWEEN #{startDate} AND #{endDate}
                    AND poc_ind_cd = '01'
                 UNION ALL
                   SELECT TO_CHAR (TO_DATE (std_ym, 'YYYYMM'), 'YYYY-MM') AS std_dt,
                          '04누적횟수' AS actnCategory,
                          chkin_acm_cnt AS chkin_user_cnt,
                          call_acm_cnt AS call_user_cnt,
                          photo_reg_acm_cnt AS photo_reg_user_cnt,
                          review_reg_acm_cnt AS review_reg_user_cnt,
                          shr_click_acm_cnt AS shr_click_user_cnt,
                          prchs_click_acm_cnt AS prchs_click_user_cnt,
                          prchs_cmpln_acm_cnt AS prchs_cmpln_user_cnt,
                          presnt_click_acm_cnt AS presnt_click_user_cnt,
                          presnt_cmpln_acm_cnt AS presnt_cmpln_user_cnt,
                          dnld_click_acm_cnt AS dnld_click_user_cnt,
                          dnld_cmpln_acm_cnt AS dnld_cmpln_user_cnt,
                          feed_click_acm_cnt AS feed_click_user_cnt,
                          ptrn_acm_cnt AS ptrn_user_cnt,
                          0 AS star_user_cnt
                     FROM obs_m_actn_sta
                    WHERE  std_ym BETWEEN #{startDate} AND #{endDate}
                    AND poc_ind_cd = '01'
                 )
        SELECT std_dt,
               actnCategory,
               DECODE (measure
                       ,'CHKIN_USER_CNT', '01체크인'
                       ,'CALL_USER_CNT', '02전화걸기 클릭'
                       ,'PHOTO_REG_USER_CNT', '03사진등록 완료'
                       ,'REVIEW_REG_USER_CNT', '04리뷰등록 완료'
--                        ,'SHR_CLICK_USER_CNT', '05공유'
                       ,'PRCHS_CLICK_USER_CNT', '06구매하기 버튼클릭'
                       ,'PRCHS_CMPLN_USER_CNT', '07구매완료'
                       ,'PRESNT_CLICK_USER_CNT', '08선물하기 버튼클릭'
                       ,'PRESNT_CMPLN_USER_CNT', '09선물완료'
                       ,'DNLD_CLICK_USER_CNT', '10다운로드 버튼클릭'
                       ,'DNLD_CMPLN_USER_CNT', '11다운로드 완료'
                       ,'FEED_CLICK_USER_CNT', '12피드 클릭'
                       ,'PTRN_USER_CNT', '13단골맺기'
--                        ,'STAR_USER_CNT', '14매장스타'
                  )  AS measure,
               measureValue
          FROM t1 UNPIVOT (measureValue
                  FOR measure
                  IN  (chkin_user_cnt
                      ,call_user_cnt
                      ,photo_reg_user_cnt
                      ,review_reg_user_cnt
--                       ,shr_click_user_cnt
                      ,prchs_click_user_cnt
                      ,prchs_cmpln_user_cnt
                      ,presnt_click_user_cnt
                      ,presnt_cmpln_user_cnt
                      ,dnld_click_user_cnt
                      ,dnld_cmpln_user_cnt
                      ,feed_click_user_cnt
                      ,ptrn_user_cnt
--                       ,star_user_cnt
                  ))
    </select>
</mapper>
