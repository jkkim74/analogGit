<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skplanet.bisportal.repository.ocb.ObsVstOsRepository">
    <select id="getVisitOsForGridPerDay" parameterType="JqGridRequest" resultType="ObsVstOsSta">
         WITH t
             AS (select   TO_CHAR(TO_DATE(std_dt,'YYYYMMDD'),'YYYY-MM-DD')||'('||TO_CHAR(to_Date(std_dt,'yyyymmdd'),'dy')||')' as std_dt,
						  '@'||os_nm as os_nm,
						  '@'||os_ver as os_ver,
                          uv AS uv,
                          lv AS lv,
                          pv AS pv,
                          vst_cnt AS vst_cnt
                     FROM obs_d_vst_os_sta
                    where std_dt between #{startDate} and #{endDate}
                      AND poc_ind_cd = '01'
                 ORDER BY std_dt, os_nm, os_ver)
        SELECT std_dt, os_nm, os_ver,
 				DECODE(measure, 'UV', '1UV', 'LV', '2LV (login visitor)','VST_CNT', '3방문횟수','PV', '4PV') AS measure, measure_value
          FROM t UNPIVOT (measure_Value FOR measure IN (uv, lv, pv, vst_cnt))
    </select>
    <select id="getVisitOsForGridPerWeek" parameterType="JqGridRequest" resultType="ObsVstOsSta">
         WITH t
             AS (select   TO_CHAR(TO_DATE(std_dt,'YYYYMMDD'),'YYYY-MM-DD')||'('||TO_CHAR(to_Date(std_dt,'yyyymmdd'),'dy')||')' as std_dt,
						  '@'||os_nm as os_nm,
						  '@'||os_ver as os_ver,
                          uv AS uv,
                          lv AS lv,
                          pv AS pv,
                          vst_cnt AS vst_cnt
                     FROM obs_w_vst_os_sta
                    where std_dt <include refid="ObsCommonMapper.betweenStartDateAndEndDatePerWeek" />
                      AND poc_ind_cd = '01'
                 ORDER BY std_dt, os_nm, os_ver)
        SELECT std_dt, os_nm, os_ver,
 				DECODE(measure, 'UV', '1UV', 'LV', '2LV (login visitor)','VST_CNT', '3방문횟수','PV', '4PV') AS measure, measure_value
          FROM t UNPIVOT (measure_Value FOR measure IN (uv, lv, pv, vst_cnt))
    </select>
    <select id="getVisitOsForGridPerMonth" parameterType="JqGridRequest" resultType="ObsVstOsSta">
         WITH t
             AS (select   TO_CHAR(TO_DATE(std_ym,'YYYYMM'),'YYYY-MM') as std_dt,
						  '@'||os_nm as os_nm,
						  '@'||os_ver as os_ver,
                          uv AS uv,
                          lv AS lv,
                          pv AS pv,
                          vst_cnt AS vst_cnt
                     FROM obs_m_vst_os_sta
                    where std_ym between #{startDate} and #{endDate}
                      AND poc_ind_cd = '01'
                 ORDER BY std_ym, os_nm, os_ver)
        SELECT std_dt, os_nm, os_ver,
 				DECODE(measure, 'UV', '1UV', 'LV', '2LV (login visitor)','VST_CNT', '3방문횟수','PV', '4PV') AS measure, measure_value
          FROM t UNPIVOT (measure_Value FOR measure IN (uv, lv, pv, vst_cnt))
    </select>
</mapper>
