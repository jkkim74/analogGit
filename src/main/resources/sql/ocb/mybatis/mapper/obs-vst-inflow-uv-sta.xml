<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skplanet.bisportal.repository.ocb.RtdDauRepository">
    <select id="getVisitInflRtForPivotPerDay" parameterType="JqGridRequest" resultType="ObsVstInflowUvSta">
        <![CDATA[
        WITH t AS (SELECT TO_CHAR(TO_DATE(STD_DT,'YYYYMMDD'),'YYYY-MM-DD')||'('||TO_CHAR(TO_DATE(STD_DT,'yyyymmdd'),'dy')||')' AS STRD_DT
                        , DAU_5VER
                        , APPCLICK_TYP
                        , INTERACT_TYP
                        , TR_TYP
                        , BLE_TYP
                        , MLEAFLET_TYP
                        , ZONE_TYP
                        , MKTGPUSH_TYP
                        , LOCK_TYP
                        , ETC_TYP
                        , OPER_DT
                     FROM OBS_D_VST_INFLOW_UV_STA
                    WHERE STD_DT BETWEEN #{startDate} AND #{endDate}
                    ORDER BY STD_DT
                  )
        SELECT STRD_DT
             , DECODE (MEASURE
                       , 'DAU_5VER','01DAU(5.0) 전체'
                       , 'APPCLICK_TYP','02&nbsp;&nbsp;&nbsp;&nbsp;Appclick을 통한 유입'
                       , 'INTERACT_TYP','03&nbsp;&nbsp;&nbsp;&nbsp;외부 채널을 통한 유입'
                       , 'TR_TYP','04&nbsp;&nbsp;&nbsp;&nbsp;포인트 활용 정보를 통한 유입'
                       , 'BLE_TYP','05&nbsp;&nbsp;&nbsp;&nbsp;BLE 서비스를 통한 유입'
                       , 'MLEAFLET_TYP','06&nbsp;&nbsp;&nbsp;&nbsp;모바일전단 Push를 통한 유입'
                       , 'ZONE_TYP','07&nbsp;&nbsp;&nbsp;&nbsp;Geofencing을 통한 유입'
                       , 'MKTGPUSH_TYP','08&nbsp;&nbsp;&nbsp;&nbsp;App Push를 통한 유입(마케팅 push, 포인트 소식 제공)'
                       , 'LOCK_TYP','09&nbsp;&nbsp;&nbsp;&nbsp;Lock 사용에 의한 UV'
                       , 'ETC_TYP','10&nbsp;&nbsp;&nbsp;&nbsp;기타 유입'
               ) AS MEASURE
             , MEASURE_VALUE
          FROM t UNPIVOT (MEASURE_VALUE FOR MEASURE
                                         IN (DAU_5VER
                                             , APPCLICK_TYP
                                             , INTERACT_TYP
                                             , TR_TYP
                                             , BLE_TYP
                                             , MLEAFLET_TYP
                                             , ZONE_TYP
                                             , MKTGPUSH_TYP
                                             , LOCK_TYP
                                             , ETC_TYP
                                            )
                         )
        ]]>
    </select>
</mapper>
