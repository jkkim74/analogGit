<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skplanet.bisportal.repository.syrup.SmwAppClickNRepository">

    <select id="getMenuVisitSituationPerDay" parameterType="OlapDimensionRequest" resultType="SmwAppClickN">
        WITH SMW_CODE1 AS (
             SELECT com_cd, (sort_seq||'@@'||cd_nm) cd_nm
                 FROM smw_code
                WHERE use_yn = 'Y'
                  AND lcl_cd  = 'SMW001'),
         SMW_CODE3 AS (
             SELECT com_cd, (sort_seq||'@@'||cd_nm) cd_nm
                 FROM smw_code
                WHERE use_yn = 'Y'
                  AND lcl_cd  = 'SMW003'),
         SMW_CODE5 AS (
             SELECT com_cd, (sort_seq||'@@'||cd_nm) cd_nm
                 FROM smw_code
                WHERE use_yn = 'Y'
                  AND lcl_cd  = 'SMW004'),
         SMW_CODE6 AS (
             SELECT com_cd, (sort_seq||'@@'||cd_nm) cd_nm
                 FROM smw_code
                WHERE use_yn = 'Y'
                  AND lcl_cd  = 'SMW002'),
         SMW_CODE7 AS (
             SELECT com_cd, (sort_seq||'@@'||cd_nm) cd_nm
                 FROM smw_code
                WHERE use_yn = 'Y'
                  AND lcl_cd  = 'SMW020'),
         SMW_CODE8 AS (
             SELECT com_cd, (sort_seq||'@@'||cd_nm) cd_nm
                 FROM smw_code
                WHERE use_yn = 'Y'
                  AND lcl_cd  = 'SMW021')
            SELECT
                <if test="useMenu != null">
                     c7.cd_nm AS menu,
                </if>
                <if test="useMenuDesc != null">
                     c8.cd_nm AS menuDesc,
                </if>
                <if test="useOs != null">
                     c1.cd_nm AS os,
                </if>
                <if test="useSex != null">
                     c3.cd_nm AS sex,
                </if>
                <if test="useAgeRange!= null">
                     c5.cd_nm AS ageRange,
                </if>
                <if test="useTelecom != null">
                     c6.cd_nm AS telecom,
                </if>
                <if test="useStandardDate != null">
                    TO_CHAR(TO_DATE(t.STRD_DT, 'YYYYMMDD'), 'YYYY-MM-DD')||'('||TO_CHAR(TO_DATE(t.STRD_DT, 'YYYYMMDD'), 'dy')|| ')' AS standardDate,
                </if>
                     SUM ( t.TOT_UV )       AS totUv,
                     SUM ( t.TOT_PV )       AS totPv
                FROM SMW_D_APP_CLICK_N t, SMW_CODE1 c1, SMW_CODE3 c3, SMW_CODE5 c5, SMW_CODE6 c6, SMW_CODE7 c7, SMW_CODE8 c8
               WHERE t.strd_dt BETWEEN #{startDate} AND #{endDate}
                 AND t.os_cd = c1.com_cd
                 AND t.gndr_cd = c3.com_cd
                 AND t.age_rng_cd = c5.com_cd
                 AND t.telc_cd = c6.com_cd
                 AND t.menu_ctg_cd = c7.com_cd
                 AND t.menu_cd = c8.com_cd
            <trim prefix="GROUP BY" suffixOverrides=",">
                <if test="useMenu != null">
                    c7.cd_nm,
                </if>
                <if test="useMenuDesc != null">
                    c8.cd_nm,
                </if>
                <if test="useOs != null">
                    c1.cd_nm,
                </if>
                <if test="useSex != null">
                    c3.cd_nm,
                </if>
                <if test="useAgeRange!= null">
                    c5.cd_nm,
                </if>
                <if test="useTelecom != null">
                    c6.cd_nm,
                </if>
                <if test="useStandardDate != null">
                    t.strd_dt,
                </if>
            </trim>
    </select>

    <select id="getMenuVisitSituationPerWeek" parameterType="OlapDimensionRequest" resultType="SmwAppClickN">
        WITH SMW_CODE1 AS (
             SELECT com_cd, (sort_seq||'@@'||cd_nm) cd_nm
                 FROM smw_code
                WHERE use_yn = 'Y'
                  AND lcl_cd  = 'SMW001'),
         SMW_CODE3 AS (
             SELECT com_cd, (sort_seq||'@@'||cd_nm) cd_nm
                 FROM smw_code
                WHERE use_yn = 'Y'
                  AND lcl_cd  = 'SMW003'),
         SMW_CODE5 AS (
             SELECT com_cd, (sort_seq||'@@'||cd_nm) cd_nm
                 FROM smw_code
                WHERE use_yn = 'Y'
                  AND lcl_cd  = 'SMW004'),
         SMW_CODE6 AS (
             SELECT com_cd, (sort_seq||'@@'||cd_nm) cd_nm
                 FROM smw_code
                WHERE use_yn = 'Y'
                  AND lcl_cd  = 'SMW002'),
         SMW_CODE7 AS (
             SELECT com_cd, (sort_seq||'@@'||cd_nm) cd_nm
                 FROM smw_code
                WHERE use_yn = 'Y'
                  AND lcl_cd  = 'SMW020'),
         SMW_CODE8 AS (
             SELECT com_cd, (sort_seq||'@@'||cd_nm) cd_nm
                 FROM smw_code
                WHERE use_yn = 'Y'
                  AND lcl_cd  = 'SMW021'),
         dateS AS (
               SELECT strd_year||LPAD(strd_wk_seq,2,'0') dateStr
                 FROM smw_cldr_wk
                WHERE #{startDate} BETWEEN wk_st_dt AND wk_ed_dt),
         dateE AS (
               SELECT strd_year||LPAD(strd_wk_seq,2,'0') dateStr
                 FROM smw_cldr_wk
                WHERE #{endDate} BETWEEN wk_st_dt AND wk_ed_dt)
            SELECT
                <if test="useMenu != null">
                     c7.cd_nm AS menu,
                </if>
                <if test="useMenuDesc != null">
                     c8.cd_nm AS menuDesc,
                </if>
                <if test="useOs != null">
                     c1.cd_nm AS os,
                </if>
                <if test="useSex != null">
                     c3.cd_nm AS sex,
                </if>
                <if test="useAgeRange!= null">
                     c5.cd_nm AS ageRange,
                </if>
                <if test="useTelecom != null">
                     c6.cd_nm AS telecom,
                </if>
                <if test="useStandardDate != null">
                     t.strd_yr||'('||LPAD(t.strd_wk,2,'0')||')' AS standardDate,
                </if>
                     SUM ( t.TOT_UV )       AS totUv,
                     SUM ( t.TOT_PV )       AS totPv
                FROM SMW_W_APP_CLICK_N t, SMW_CODE1 c1, SMW_CODE3 c3, SMW_CODE5 c5, SMW_CODE6 c6, dateS, dateE, SMW_CODE7 c7, SMW_CODE8 c8
               WHERE (t.strd_yr||LPAD(t.strd_wk,2,'0')) BETWEEN dateS.dateStr AND dateE.dateStr
                 AND t.os_cd = c1.com_cd
                 AND t.gndr_cd = c3.com_cd
                 AND t.age_rng_cd = c5.com_cd
                 AND t.telc_cd = c6.com_cd
                 AND t.menu_ctg_cd = c7.com_cd
                 AND t.menu_cd = c8.com_cd
            <trim prefix="GROUP BY" suffixOverrides=",">
                <if test="useMenu != null">
                    c7.cd_nm,
                </if>
                <if test="useMenuDesc != null">
                    c8.cd_nm,
                </if>
                <if test="useOs != null">
                    c1.cd_nm,
                </if>
                <if test="useSex != null">
                    c3.cd_nm,
                </if>
                <if test="useAppVersion != null">
                    c4.cd_nm,
                </if>
                <if test="useAgeRange!= null">
                    c5.cd_nm,
                </if>
                <if test="useTelecom != null">
                    c6.cd_nm,
                </if>
                <if test="useStandardDate != null">
                    t.strd_yr||'('||LPAD(t.strd_wk,2,'0')||')',
                </if>
            </trim>
    </select>

    <select id="getMenuVisitSituationPerMonth" parameterType="OlapDimensionRequest" resultType="SmwAppClickN">
        WITH SMW_CODE1 AS (
             SELECT com_cd, (sort_seq||'@@'||cd_nm) cd_nm
                 FROM smw_code
                WHERE use_yn = 'Y'
                  AND lcl_cd  = 'SMW001'),
         SMW_CODE3 AS (
             SELECT com_cd, (sort_seq||'@@'||cd_nm) cd_nm
                 FROM smw_code
                WHERE use_yn = 'Y'
                  AND lcl_cd  = 'SMW003'),
         SMW_CODE5 AS (
             SELECT com_cd, (sort_seq||'@@'||cd_nm) cd_nm
                 FROM smw_code
                WHERE use_yn = 'Y'
                  AND lcl_cd  = 'SMW004'),
         SMW_CODE6 AS (
             SELECT com_cd, (sort_seq||'@@'||cd_nm) cd_nm
                 FROM smw_code
                WHERE use_yn = 'Y'
                  AND lcl_cd  = 'SMW002'),
         SMW_CODE7 AS (
             SELECT com_cd, (sort_seq||'@@'||cd_nm) cd_nm
                 FROM smw_code
                WHERE use_yn = 'Y'
                  AND lcl_cd  = 'SMW020'),
         SMW_CODE8 AS (
             SELECT com_cd, (sort_seq||'@@'||cd_nm) cd_nm
                 FROM smw_code
                WHERE use_yn = 'Y'
                  AND lcl_cd  = 'SMW021')
            SELECT
                <if test="useMenu != null">
                     c7.cd_nm AS menu,
                </if>
                <if test="useMenuDesc != null">
                     c8.cd_nm AS menuDesc,
                </if>
                <if test="useOs != null">
                     c1.cd_nm AS os,
                </if>
                <if test="useSex != null">
                     c3.cd_nm AS sex,
                </if>
                <if test="useAgeRange!= null">
                     c5.cd_nm AS ageRange,
                </if>
                <if test="useTelecom != null">
                     c6.cd_nm AS telecom,
                </if>
                <if test="useStandardDate != null">
                     TO_CHAR (TO_DATE (t.strd_ym, 'YYYYMM'), 'YYYY-MM') AS standardDate,
                </if>
                     SUM ( t.TOT_UV )       AS totUv,
                     SUM ( t.TOT_PV )       AS totPv
                FROM SMW_M_APP_CLICK_N t, SMW_CODE1 c1, SMW_CODE3 c3, SMW_CODE5 c5, SMW_CODE6 c6, SMW_CODE7 c7, SMW_CODE8 c8
               WHERE t.strd_ym BETWEEN #{startDate} AND #{endDate}
                 AND t.os_cd = c1.com_cd
                 AND t.gndr_cd = c3.com_cd
                 AND t.age_rng_cd = c5.com_cd
                 AND t.telc_cd = c6.com_cd
                 AND t.menu_ctg_cd = c7.com_cd
                 AND t.menu_cd = c8.com_cd
            <trim prefix="GROUP BY" suffixOverrides=",">
                <if test="useMenu != null">
                    c7.cd_nm,
                </if>
                <if test="useMenuDesc != null">
                    c8.cd_nm,
                </if>
                <if test="useOs != null">
                    c1.cd_nm,
                </if>
                <if test="useSex != null">
                    c3.cd_nm,
                </if>
                <if test="useAppVersion != null">
                    c4.cd_nm,
                </if>
                <if test="useAgeRange!= null">
                    c5.cd_nm,
                </if>
                <if test="useTelecom != null">
                    c6.cd_nm,
                </if>
                <if test="useStandardDate != null">
                    t.strd_ym,
                </if>
            </trim>
    </select>


</mapper>
