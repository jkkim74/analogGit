<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skplanet.bisportal.repository.syrup.SmwCponStatDtlRepository">
    <select id="getCponStatDtlPerDay" parameterType="JqGridRequest" resultType="SmwCponStatDtl">
        <![CDATA[
            SELECT totalRecordCount, CP_PROD_CD, CPON_NM, PT_NM, REG_POC_NM, ISSUE_CNT, ACCUM_ISSUE_CNT, USE_CNT, ACCUM_USE_CNT,
                   SHOW_CNT, ACCUM_SHOW_CNT, ISSUE_PAGE_CNT, ACCUM_ISSUE_PAGE_CNT, ISSUE_PAGE_DTL_CNT, ACCUM_ISSUE_PAGE_DTL_CNT, rnum
            FROM (
                SELECT totalRecordCount, CP_PROD_CD, CPON_NM, PT_NM, REG_POC_NM, ISSUE_CNT, ACCUM_ISSUE_CNT, USE_CNT, ACCUM_USE_CNT,
                       SHOW_CNT, ACCUM_SHOW_CNT, ISSUE_PAGE_CNT, ACCUM_ISSUE_PAGE_CNT, ISSUE_PAGE_DTL_CNT, ACCUM_ISSUE_PAGE_DTL_CNT, rownum rnum
                FROM (
                    SELECT /*+ ORDERED USE_HASH(CPN, CPND) */ COUNT(*) OVER() totalRecordCount, CPND.CP_PROD_CD AS CP_PROD_CD
                        , CPND.CPON_NM AS CPON_NM
                        , CPN.PT_NM AS PT_NM
                        , CD.CD_NM AS REG_POC_NM
                        , SUM(CPND.ISSUE_CNT) AS ISSUE_CNT
                        , MAX(CPND.ACCUM_ISSUE_CNT) AS ACCUM_ISSUE_CNT
                        , SUM(CPND.USE_CNT) AS USE_CNT
                        , MAX(CPND.ACCUM_USE_CNT) AS ACCUM_USE_CNT
                        , SUM(CPND.SHOW_CNT) AS SHOW_CNT
                        , MAX(CPND.ACCUM_SHOW_CNT) AS ACCUM_SHOW_CNT
                        , SUM(CPND.ISSUE_PAGE_CNT) AS ISSUE_PAGE_CNT
                        , MAX(CPND.ACCUM_ISSUE_PAGE_CNT) AS ACCUM_ISSUE_PAGE_CNT
                        , SUM(CPND.ISSUE_PAGE_DTL_CNT) AS ISSUE_PAGE_DTL_CNT
                        , MAX(CPND.ACCUM_ISSUE_PAGE_DTL_CNT) AS ACCUM_ISSUE_PAGE_DTL_CNT
                    FROM  SMW_CODE CD, SMW_COUPON CPN, SMW_D_CPON_STAT_DTL CPND
                    WHERE CPN.CP_PROD_CD(+) = CPND.CP_PROD_CD
                    AND   CD.COM_CD(+) = CPN.REG_POC_CD
                    AND   CD.LCL_CD = 'SMW022'
                    AND   CPND.STRD_DT BETWEEN #{startDate} AND #{endDate}
                    GROUP BY CPND.CP_PROD_CD, CPND.CPON_NM, CPN.PT_NM, CD.CD_NM
                    ORDER BY CPND.CP_PROD_CD, CPND.CPON_NM
                ) WHERE rownum <= #{lastIndex}
            ) WHERE rnum > #{firstIndex}
        ]]>
    </select>
    <select id="getCponStatDtlPerDayForExcel" parameterType="JqGridRequest" resultType="SmwCponStatDtl">
        <![CDATA[
            SELECT /*+ ORDERED USE_HASH(CPN, CPND) */ CPND.CP_PROD_CD AS CP_PROD_CD
                , CPND.CPON_NM AS CPON_NM
                , CPN.PT_NM AS PT_NM
                , CD.CD_NM AS REG_POC_NM
                , SUM(CPND.ISSUE_CNT) AS ISSUE_CNT
                , MAX(CPND.ACCUM_ISSUE_CNT) AS ACCUM_ISSUE_CNT
                , SUM(CPND.USE_CNT) AS USE_CNT
                , MAX(CPND.ACCUM_USE_CNT) AS ACCUM_USE_CNT
                , SUM(CPND.SHOW_CNT) AS SHOW_CNT
                , MAX(CPND.ACCUM_SHOW_CNT) AS ACCUM_SHOW_CNT
                , SUM(CPND.ISSUE_PAGE_CNT) AS ISSUE_PAGE_CNT
                , MAX(CPND.ACCUM_ISSUE_PAGE_CNT) AS ACCUM_ISSUE_PAGE_CNT
                , SUM(CPND.ISSUE_PAGE_DTL_CNT) AS ISSUE_PAGE_DTL_CNT
                , MAX(CPND.ACCUM_ISSUE_PAGE_DTL_CNT) AS ACCUM_ISSUE_PAGE_DTL_CNT
            FROM  SMW_CODE CD, SMW_COUPON CPN, SMW_D_CPON_STAT_DTL CPND
            WHERE CPN.CP_PROD_CD(+) = CPND.CP_PROD_CD
            AND   CD.COM_CD(+) = CPN.REG_POC_CD
            AND   CD.LCL_CD = 'SMW022'
            AND   CPND.STRD_DT BETWEEN #{startDate} AND #{endDate}
            GROUP BY CPND.CP_PROD_CD, CPND.CPON_NM, CPN.PT_NM, CD.CD_NM
            ORDER BY CPND.CP_PROD_CD, CPND.CPON_NM
        ]]>
    </select>
    <select id="getCponStatDtlPerWeek" parameterType="JqGridRequest" resultType="SmwCponStatDtl">
        <![CDATA[
            SELECT totalRecordCount, CP_PROD_CD, CPON_NM, PT_NM, REG_POC_NM, ISSUE_CNT, ACCUM_ISSUE_CNT, USE_CNT, ACCUM_USE_CNT,
                   SHOW_CNT, ACCUM_SHOW_CNT, ISSUE_PAGE_CNT, ACCUM_ISSUE_PAGE_CNT, ISSUE_PAGE_DTL_CNT, ACCUM_ISSUE_PAGE_DTL_CNT, rnum
            FROM (
                SELECT totalRecordCount, CP_PROD_CD, CPON_NM, PT_NM, REG_POC_NM, ISSUE_CNT, ACCUM_ISSUE_CNT, USE_CNT, ACCUM_USE_CNT,
                       SHOW_CNT, ACCUM_SHOW_CNT, ISSUE_PAGE_CNT, ACCUM_ISSUE_PAGE_CNT, ISSUE_PAGE_DTL_CNT, ACCUM_ISSUE_PAGE_DTL_CNT, rownum rnum
                FROM (
                    SELECT /*+ ORDERED USE_HASH(CPN, CPND) */ COUNT(*) OVER() totalRecordCount, CPND.CP_PROD_CD AS CP_PROD_CD
                       , CPND.CPON_NM AS CPON_NM
                       , CPN.PT_NM AS PT_NM
                       , CD.CD_NM AS REG_POC_NM
                       , SUM(CPND.ISSUE_CNT) AS ISSUE_CNT
                       , MAX(CPND.ACCUM_ISSUE_CNT) AS ACCUM_ISSUE_CNT
                       , SUM(CPND.USE_CNT) AS USE_CNT
                       , MAX(CPND.ACCUM_USE_CNT) AS ACCUM_USE_CNT
                       , SUM(CPND.SHOW_CNT) AS SHOW_CNT
                       , MAX(CPND.ACCUM_SHOW_CNT) AS ACCUM_SHOW_CNT
                       , SUM(CPND.ISSUE_PAGE_CNT) AS ISSUE_PAGE_CNT
                       , MAX(CPND.ACCUM_ISSUE_PAGE_CNT) AS ACCUM_ISSUE_PAGE_CNT
                       , SUM(CPND.ISSUE_PAGE_DTL_CNT) AS ISSUE_PAGE_DTL_CNT
                       , MAX(CPND.ACCUM_ISSUE_PAGE_DTL_CNT) AS ACCUM_ISSUE_PAGE_DTL_CNT
                    FROM  SMW_CODE CD, SMW_COUPON CPN, SMW_D_CPON_STAT_DTL CPND
                    WHERE CPN.CP_PROD_CD(+) = CPND.CP_PROD_CD
                    AND   CD.COM_CD(+) = CPN.REG_POC_CD
                    AND   CD.LCL_CD = 'SMW022'
                    AND   CPND.STRD_DT BETWEEN
                      (SELECT WK_ST_DT FROM SMW_CLDR_WK WHERE WK_ST_DT <= #{startDate} AND WK_ED_DT >= #{startDate})
                      AND (SELECT WK_ED_DT FROM SMW_CLDR_WK WHERE WK_ST_DT <= #{endDate} AND WK_ED_DT >= #{endDate})
                    GROUP BY CPND.CP_PROD_CD, CPND.CPON_NM, CPN.PT_NM, CD.CD_NM
                    ORDER BY CPND.CP_PROD_CD, CPND.CPON_NM
                ) WHERE rownum <= #{lastIndex}
            ) WHERE rnum > #{firstIndex}
        ]]>
    </select>
    <select id="getCponStatDtlPerWeekForExcel" parameterType="JqGridRequest" resultType="SmwCponStatDtl">
        <![CDATA[
            SELECT /*+ ORDERED USE_HASH(CPN, CPND) */ CPND.CP_PROD_CD AS CP_PROD_CD
               , CPND.CPON_NM AS CPON_NM
               , CPN.PT_NM AS PT_NM
               , CD.CD_NM AS REG_POC_NM
               , SUM(CPND.ISSUE_CNT) AS ISSUE_CNT
               , MAX(CPND.ACCUM_ISSUE_CNT) AS ACCUM_ISSUE_CNT
               , SUM(CPND.USE_CNT) AS USE_CNT
               , MAX(CPND.ACCUM_USE_CNT) AS ACCUM_USE_CNT
               , SUM(CPND.SHOW_CNT) AS SHOW_CNT
               , MAX(CPND.ACCUM_SHOW_CNT) AS ACCUM_SHOW_CNT
               , SUM(CPND.ISSUE_PAGE_CNT) AS ISSUE_PAGE_CNT
               , MAX(CPND.ACCUM_ISSUE_PAGE_CNT) AS ACCUM_ISSUE_PAGE_CNT
               , SUM(CPND.ISSUE_PAGE_DTL_CNT) AS ISSUE_PAGE_DTL_CNT
               , MAX(CPND.ACCUM_ISSUE_PAGE_DTL_CNT) AS ACCUM_ISSUE_PAGE_DTL_CNT
            FROM  SMW_CODE CD, SMW_COUPON CPN, SMW_D_CPON_STAT_DTL CPND
            WHERE CPN.CP_PROD_CD(+) = CPND.CP_PROD_CD
            AND   CD.COM_CD(+) = CPN.REG_POC_CD
            AND   CD.LCL_CD = 'SMW022'
            AND   CPND.STRD_DT BETWEEN
              (SELECT WK_ST_DT FROM SMW_CLDR_WK WHERE WK_ST_DT <= #{startDate} AND WK_ED_DT >= #{startDate})
              AND (SELECT WK_ED_DT FROM SMW_CLDR_WK WHERE WK_ST_DT <= #{endDate} AND WK_ED_DT >= #{endDate})
            GROUP BY CPND.CP_PROD_CD, CPND.CPON_NM, CPN.PT_NM, CD.CD_NM
            ORDER BY CPND.CP_PROD_CD, CPND.CPON_NM
        ]]>
    </select>
    <select id="getCponStatDtlPerMonth" parameterType="JqGridRequest" resultType="SmwCponStatDtl">
        <![CDATA[
            SELECT totalRecordCount, CP_PROD_CD, CPON_NM, PT_NM, REG_POC_NM, ISSUE_CNT, ACCUM_ISSUE_CNT, USE_CNT, ACCUM_USE_CNT,
                   SHOW_CNT, ACCUM_SHOW_CNT, ISSUE_PAGE_CNT, ACCUM_ISSUE_PAGE_CNT, ISSUE_PAGE_DTL_CNT, ACCUM_ISSUE_PAGE_DTL_CNT, rnum
            FROM (
                SELECT totalRecordCount, CP_PROD_CD, CPON_NM, PT_NM, REG_POC_NM, ISSUE_CNT, ACCUM_ISSUE_CNT, USE_CNT, ACCUM_USE_CNT,
                       SHOW_CNT, ACCUM_SHOW_CNT, ISSUE_PAGE_CNT, ACCUM_ISSUE_PAGE_CNT, ISSUE_PAGE_DTL_CNT, ACCUM_ISSUE_PAGE_DTL_CNT, rownum rnum
                FROM (
                    SELECT /*+ ORDERED USE_HASH(CPN, CPND) */ COUNT(*) OVER() totalRecordCount, CPND.CP_PROD_CD AS CP_PROD_CD
                         , CPND.CPON_NM AS CPON_NM
                         , CPN.PT_NM AS PT_NM
                         , CD.CD_NM AS REG_POC_NM
                         , SUM(CPND.ISSUE_CNT) AS ISSUE_CNT
                         , MAX(CPND.ACCUM_ISSUE_CNT) AS ACCUM_ISSUE_CNT
                         , SUM(CPND.USE_CNT) AS USE_CNT
                         , MAX(CPND.ACCUM_USE_CNT) AS ACCUM_USE_CNT
                         , SUM(CPND.SHOW_CNT) AS SHOW_CNT
                         , MAX(CPND.ACCUM_SHOW_CNT) AS ACCUM_SHOW_CNT
                         , SUM(CPND.ISSUE_PAGE_CNT) AS ISSUE_PAGE_CNT
                         , MAX(CPND.ACCUM_ISSUE_PAGE_CNT) AS ACCUM_ISSUE_PAGE_CNT
                         , SUM(CPND.ISSUE_PAGE_DTL_CNT) AS ISSUE_PAGE_DTL_CNT
                         , MAX(CPND.ACCUM_ISSUE_PAGE_DTL_CNT) AS ACCUM_ISSUE_PAGE_DTL_CNT
                      FROM  SMW_CODE CD, SMW_COUPON CPN, SMW_D_CPON_STAT_DTL CPND
                      WHERE CPN.CP_PROD_CD(+) = CPND.CP_PROD_CD
                      AND   CD.COM_CD(+) = CPN.REG_POC_CD
                      AND   CD.LCL_CD = 'SMW022'
                      AND   CPND.STRD_YM BETWEEN #{startDate} AND #{endDate}
                      GROUP BY CPND.CP_PROD_CD, CPND.CPON_NM, CPN.PT_NM, CD.CD_NM
                      ORDER BY CPND.CP_PROD_CD, CPND.CPON_NM
                ) WHERE rownum <= #{lastIndex}
            ) WHERE rnum > #{firstIndex}
      ]]>
    </select>
    <select id="getCponStatDtlPerMonthForExcel" parameterType="JqGridRequest" resultType="SmwCponStatDtl">
        <![CDATA[
            SELECT /*+ ORDERED USE_HASH(CPN, CPND) */ CPND.CP_PROD_CD AS CP_PROD_CD
                 , CPND.CPON_NM AS CPON_NM
                 , CPN.PT_NM AS PT_NM
                 , CD.CD_NM AS REG_POC_NM
                 , SUM(CPND.ISSUE_CNT) AS ISSUE_CNT
                 , MAX(CPND.ACCUM_ISSUE_CNT) AS ACCUM_ISSUE_CNT
                 , SUM(CPND.USE_CNT) AS USE_CNT
                 , MAX(CPND.ACCUM_USE_CNT) AS ACCUM_USE_CNT
                 , SUM(CPND.SHOW_CNT) AS SHOW_CNT
                 , MAX(CPND.ACCUM_SHOW_CNT) AS ACCUM_SHOW_CNT
                 , SUM(CPND.ISSUE_PAGE_CNT) AS ISSUE_PAGE_CNT
                 , MAX(CPND.ACCUM_ISSUE_PAGE_CNT) AS ACCUM_ISSUE_PAGE_CNT
                 , SUM(CPND.ISSUE_PAGE_DTL_CNT) AS ISSUE_PAGE_DTL_CNT
                 , MAX(CPND.ACCUM_ISSUE_PAGE_DTL_CNT) AS ACCUM_ISSUE_PAGE_DTL_CNT
              FROM  SMW_CODE CD, SMW_COUPON CPN, SMW_D_CPON_STAT_DTL CPND
              WHERE CPN.CP_PROD_CD(+) = CPND.CP_PROD_CD
              AND   CD.COM_CD(+) = CPN.REG_POC_CD
              AND   CD.LCL_CD = 'SMW022'
              AND   CPND.STRD_YM BETWEEN #{startDate} AND #{endDate}
              GROUP BY CPND.CP_PROD_CD, CPND.CPON_NM, CPN.PT_NM, CD.CD_NM
              ORDER BY CPND.CP_PROD_CD, CPND.CPON_NM
      ]]>
    </select>
</mapper>
