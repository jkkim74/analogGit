<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skplanet.bisportal.repository.syrup.SmwCponLocStatRepository">
    <select id="getCponLocStatPerDay" parameterType="JqGridRequest" resultType="SmwCponLocStat">
        <![CDATA[
            SELECT TO_CHAR(TO_DATE (STRD_DT, 'YYYYMMDD'), 'YYYY-MM-DD')||'('|| TO_CHAR (TO_DATE (STRD_DT, 'yyyymmdd'), 'dy')|| ')' AS DISP_DT
                 , CD2.SORT_SEQ AS SORT_SEQ3
                 , CD2.COM_CD AS COM_CD3
                 , CD2.CD_NM AS CD_NM3
                 , CPNL.TGT_ORDER AS TGT_ORDER
                 , CPNL.BRAND_NM AS BRAND_NM
                 , CPNL.CP_NM AS CP_NM
                 , PAGE_CNT AS PAGE_CNT
                 , PAGE_USER_CNT AS PAGE_USER_CNT
            FROM (SELECT /*+ INDEX_FFS(SMW_D_CPON_LOC_STAT PK_SMW_D_CPON_LOC_STAT) PARALLEL(SMW_D_CPON_LOC_STAT) */ STRD_DT, MENU, REC_TYPE AS REC_TYPE3, TGT_ORDER, BRAND_NM, CP_NM
                       , SUM(PAGE_CNT) AS PAGE_CNT
                       , SUM(PAGE_USER_CNT) AS PAGE_USER_CNT
                    FROM SMW_D_CPON_LOC_STAT
                    WHERE STRD_DT BETWEEN #{startDate} AND #{endDate}
                    GROUP BY STRD_DT, MENU, REC_TYPE, TGT_ORDER, BRAND_NM, CP_NM
                 ) CPNL
            LEFT JOIN SMW_CODE CD2 ON CPNL.REC_TYPE3 = CD2.COM_CD AND CD2.LCL_CD = 'SMW017'
            ORDER BY STRD_DT, CD2.SORT_SEQ, CPNL.TGT_ORDER, CPNL.BRAND_NM, CPNL.CP_NM
      ]]>
    </select>
    <select id="getCponLocStatPerWeek" parameterType="JqGridRequest" resultType="SmwCponLocStat">
        <![CDATA[
            SELECT CPNL.DISP_WK AS DISP_DT
                , CD2.SORT_SEQ AS SORT_SEQ3
                , CD2.COM_CD AS COM_CD3
                , CD2.CD_NM AS CD_NM3
                , CPNL.TGT_ORDER AS TGT_ORDER
                , CPNL.BRAND_NM AS BRAND_NM
                , CPNL.CP_NM AS CP_NM
                , PAGE_CNT AS PAGE_CNT
                , PAGE_USER_CNT AS PAGE_USER_CNT
            FROM (SELECT /*+ INDEX_FFS(SMW_W_CPON_LOC_STAT PK_SMW_W_CPON_LOC_STAT) PARALLEL(SMW_W_CPON_LOC_STAT) */ STRD_YR||'-'||STRD_WK AS DISP_WK, MENU, REC_TYPE AS REC_TYPE3, TGT_ORDER, BRAND_NM, CP_NM
                  , SUM(PAGE_CNT) AS PAGE_CNT
                  , SUM(PAGE_USER_CNT) AS PAGE_USER_CNT
                  FROM  SMW_W_CPON_LOC_STAT
                  WHERE STRD_YR||LPAD(STRD_WK,2,'0') BETWEEN
                    (SELECT STRD_YEAR||LPAD(STRD_WK_SEQ,2,'0') FROM SMW_CLDR_WK WHERE WK_ST_DT <= #{startDate} AND WK_ED_DT >= #{startDate})
                    AND (SELECT STRD_YEAR||LPAD(STRD_WK_SEQ,2,'0') FROM SMW_CLDR_WK WHERE WK_ST_DT <= #{endDate} AND WK_ED_DT >= #{endDate})
                  GROUP BY STRD_YR||'-'||STRD_WK, MENU, REC_TYPE, TGT_ORDER, BRAND_NM, CP_NM
                 ) CPNL
            LEFT JOIN SMW_CODE CD2 ON CPNL.REC_TYPE3 = CD2.COM_CD AND CD2.LCL_CD = 'SMW017'
            ORDER BY CPNL.DISP_WK, CD2.SORT_SEQ, CPNL.TGT_ORDER, CPNL.BRAND_NM, CPNL.CP_NM
        ]]>
    </select>
    <select id="getCponLocStatPerMonth" parameterType="JqGridRequest" resultType="SmwCponLocStat">
        <![CDATA[
            SELECT TO_CHAR(TO_DATE(STRD_YM, 'YYYYMM'), 'YYYY-MM') AS DISP_DT
                 , CD2.SORT_SEQ AS SORT_SEQ3
                 , CD2.COM_CD AS COM_CD3
                 , CD2.CD_NM AS CD_NM3
                 , CPNL.TGT_ORDER AS TGT_ORDER
                 , CPNL.BRAND_NM AS BRAND_NM
                 , CPNL.CP_NM AS CP_NM
                 , PAGE_CNT AS PAGE_CNT
                 , PAGE_USER_CNT AS PAGE_USER_CNT
            FROM (SELECT /*+ INDEX_FFS(SMW_M_CPON_LOC_STAT PK_SMW_M_CPON_LOC_STAT) PARALLEL(SMW_M_CPON_LOC_STAT) */ STRD_YM, MENU, REC_TYPE AS REC_TYPE3, TGT_ORDER, BRAND_NM, CP_NM
                     , SUM(PAGE_CNT) AS PAGE_CNT
                     , SUM(PAGE_USER_CNT) AS PAGE_USER_CNT
                  FROM SMW_M_CPON_LOC_STAT
                  WHERE STRD_YM BETWEEN #{startDate} AND #{endDate}
                  GROUP BY STRD_YM, MENU, REC_TYPE, TGT_ORDER, BRAND_NM, CP_NM
                 ) CPNL
            LEFT JOIN SMW_CODE CD2 ON CPNL.REC_TYPE3 = CD2.COM_CD AND CD2.LCL_CD = 'SMW017'
            ORDER BY STRD_YM, CD2.SORT_SEQ, CPNL.TGT_ORDER, CPNL.BRAND_NM, CPNL.CP_NM
        ]]>
    </select>
</mapper>
