<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skplanet.pandora.repository.mysql.MysqlRepository">

    <select id="selectUploadProgress" parameterType="map" resultType="com.skplanet.pandora.model.UploadProgress">
        SELECT PAGE_ID
             , USERNAME
             , COLUMN_NAME
             , UPLOAD_STATUS
        FROM   UPLOAD_PROGRESS
        WHERE  PAGE_ID = #{pageId} AND USERNAME = #{username}
    </select>

    <update id="upsertUploadProgress" parameterType="map">
        INSERT INTO UPLOAD_PROGRESS (PAGE_ID, USERNAME, COLUMN_NAME, UPLOAD_STATUS)
        VALUES (#{pageId}, #{username}, #{columnName}, #{uploadStatus})
        ON DUPLICATE KEY
        <trim prefix="UPDATE" suffixOverrides=",">
	        <if test="columnName != null and columnName != ''">COLUMN_NAME = #{columnName},</if>
	        <if test="uploadStatus != null">UPLOAD_STATUS = #{uploadStatus},</if>
        </trim>
    </update>

</mapper>
