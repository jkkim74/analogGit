<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skplanet.bisportal.repository.bip.OrgUserRepository">
    <select id="getOrgUserTree" parameterType="OrgUser" resultType="OrgUser">
        SELECT /*+ 사용자정보관리 조회 */
            CP.EMAIL_ADDR				/** EMAIL주소 */
            , CP.OFFC_PHON_NUM			/** 직장전화번호 */
            , CP.MBL_PHON_NUM			/** 이동전화번호 */
            , CP.AUDIT_ID				/** 최종변경자ID */
            , CP.AUDIT_DTM				/** 최종변경일시 */
            , CP.LOGIN_ID				/** 로그인ID */
            , CP.USER_NM 				/** 사용자명 */
            , DECODE(CP.ACTVN_YN, 'Y', '재직', '퇴직') as ACTVN_YN /** 활성화여부 */
            , CP.USER_ST_CD			    /** 사용자ID상태코드 */
            , CP.ORG_CD			        /** 소속조직ID */
            , CP.APLY_STA_DT			/** 적용시작일자 */
            , CP.APLY_END_DT			/** 적용종료일자 */
            , CP.PSN_TYP_CD				/** 인물유형코드 */
            , CP.JBCHARGE		        /** SKP정직원직책코드 */
            , CP.JBCHARGENM             /** 직책이름 */
            , DECODE(SUBSTR(CP.LOGIN_ID, 1, 2), '10', '정규', '50', '파견', '70', '임원', '90', '외부', 'PP', 'BP', '기타') as USERTYPE /** 사용자구분 */
            , CP.HOLDOFFIDIVI			/** 재직구분 */
            , CP.AUTHOR				    /** 결재승인자 */
            , CD.ORG_NM					/** 조직명 */
        FROM COM_PERSON CP, COM_DEPT CD
        WHERE CP.ORG_CD = CD.ORG_CD
        <if test="searchCondition != null and searchCondition.equals('orgCd')">
            AND CP.ORG_CD = #{searchKeyword}
        </if>
        <if test="searchCondition != null and searchCondition.equals('userNm')">
            AND CP.USER_NM = #{searchKeyword}
        </if>
        <if test="searchCondition != null and searchCondition.equals('loginId')">
            AND CP.LOGIN_ID = #{searchKeyword}
        </if>
        <if test="userType != null and userType != '' and userType == 1">
            AND (CP.LOGIN_ID LIKE '1%' OR CP.LOGIN_ID LIKE '7%')
        </if>
        <if test="userType != null and userType != '' and userType == 2">
            AND CP.ACTVN_YN = 'Y'
        </if>
    </select>

    <select id="getOrgTree" resultType="OrgUser">
        WITH LVL AS (
            SELECT ORG_CD, ORG_NM, SUP_ORG_CD, SUP_ORG_NM, LEVEL LVL, ORG_PRT_SEQ, '' USER_ID, '' USER_NM, '' LOGIN_ID
            FROM   COM_DEPT
            WHERE  TO_CHAR (SYSDATE, 'YYYYMMDD') BETWEEN APLY_STA_DT
            AND    APLY_END_DT START WITH ORG_CD = 'PORG00006000'
            CONNECT BY PRIOR ORG_CD = SUP_ORG_CD
        )
        SELECT LVL.*, (SELECT MAX(LVL) FROM LVL) MAX_LVL
        FROM LVL
        ORDER BY ORG_PRT_SEQ, SUP_ORG_NM
    </select>
    <select id="getOrgGrid" parameterType="OrgUser" resultType="ComDept">
        SELECT D.ORG_CD, D.ORG_NM, D.SUP_ORG_CD, D.SUP_ORG_NM
             , DECODE(D.GROUP_TYPE, '1', '정조직', '가상조직') as GROUP_TYPE
             , D.ORG_PRT_SEQ
             , TO_CHAR(TO_DATE(D.APLY_STA_DT, 'yyyymmdd'),'yyyy-mm-dd') AS APLY_STA_DT
             , TO_CHAR(TO_DATE(D.APLY_END_DT, 'yyyymmdd'),'yyyy-mm-dd') AS APLY_END_DT
             , D.ACTVN_YN, P.USER_NM AS DIR_LOGINID
        FROM  COM_DEPT D, COM_PERSON P
        WHERE D.DIR_LOGINID = P.LOGIN_ID(+)
        AND   D.ACTVN_YN = 'Y'
        <if test="searchCondition != null and searchCondition.equals('orgCd')">
            AND D.ORG_CD = #{searchKeyword}
        </if>
        <if test="searchCondition != null and searchCondition.equals('orgNm')">
            AND D.ORG_NM like #{searchKeyword}
        </if>
        <if test="groupType != null and !groupType.equals('all')">
            AND D.GROUP_TYPE = #{groupType}
        </if>
        ORDER BY D.ORG_PRT_SEQ, D.SUP_ORG_NM
    </select>
    <select id="getEmailOrgUser" parameterType="Long" resultType="OrgUser">
        SELECT c.login_id as login_id, c.login_id as userId, c.user_nm as user_nm, c.email_addr as email_addr, o.org_nm, c.mbl_phon_num
        FROM   eisuser.BPM_MGNT_EMAIL_SND_USER e, COM_PERSON c, COM_DEPT o
        WHERE  e.login_id = c.login_id
        AND    c.org_cd = o.org_cd
        AND    e.snd_obj_id = #{sndObjId}
        ORDER BY user_nm ASC
    </select>

    <select id="getBusinessOcbSyrupDatas" parameterType="JqGridRequest" resultType="BpmDlyPrst">
        <![CDATA[
        SELECT dly_strd_dt, svc_id, idx_cl_grp_cd, idx_cl_cd, idx_ctt_cd, dly_rslt_val
        FROM (
            SELECT /*+ OCB */ #{basicDate} as DLY_STRD_DT, 25 as SVC_ID, 'L091' as IDX_CL_GRP_CD, 'M001' as IDX_CL_CD, 'S001' as IDX_CTT_CD, count(*) as DLY_RSLT_VAL
            FROM   EISUSER.BPM_DLY_PRST
            WHERE  DLY_STRD_DT = #{basicDate}
            AND    SVC_ID = 25 AND IDX_CL_GRP_CD = 'L091' AND IDX_CL_CD = 'M001' AND IDX_CTT_CD = 'S001'
            HAVING count(*) < 1
            UNION
            SELECT #{basicDate} as DLY_STRD_DT, 25 as SVC_ID, 'L092' as IDX_CL_GRP_CD, 'M001' as IDX_CL_CD, 'S001' as IDX_CTT_CD, count(*) as DLY_RSLT_VAL
            FROM   EISUSER.BPM_DLY_PRST
            WHERE  DLY_STRD_DT = #{basicDate}
            AND    SVC_ID = 25 AND IDX_CL_GRP_CD = 'L092' AND IDX_CL_CD = 'M001' AND IDX_CTT_CD = 'S001'
            HAVING count(*) < 1
            UNION
            SELECT #{basicDate} as DLY_STRD_DT, 25 as SVC_ID, 'L093' as IDX_CL_GRP_CD, 'M001' as IDX_CL_CD, 'S001' as IDX_CTT_CD, count(*) as DLY_RSLT_VAL
            FROM   EISUSER.BPM_DLY_PRST
            WHERE  DLY_STRD_DT = #{basicDate}
            AND    SVC_ID = 25 AND IDX_CL_GRP_CD = 'L093' AND IDX_CL_CD = 'M001' AND IDX_CTT_CD = 'S001'
            HAVING count(*) < 1
            UNION
            SELECT /*+ Syrup */ #{basicDate} as DLY_STRD_DT, 8 as SVC_ID, 'L091' as IDX_CL_GRP_CD, 'M001' as IDX_CL_CD, 'S001' as IDX_CTT_CD, count(*) as DLY_RSLT_VAL
            FROM   EISUSER.BPM_DLY_PRST
            WHERE  DLY_STRD_DT = #{basicDate}
            AND    SVC_ID = 8 AND IDX_CL_GRP_CD = 'L091' AND IDX_CL_CD = 'M001' AND IDX_CTT_CD = 'S001'
            HAVING count(*) < 1
            UNION
            SELECT #{basicDate} as DLY_STRD_DT, 8 as SVC_ID, 'L092' as IDX_CL_GRP_CD, 'M001' as IDX_CL_CD, 'S001' as IDX_CTT_CD, count(*) as DLY_RSLT_VAL
            FROM   EISUSER.BPM_DLY_PRST
            WHERE  DLY_STRD_DT = #{basicDate}
            AND    SVC_ID = 8 AND IDX_CL_GRP_CD = 'L092' AND IDX_CL_CD = 'M001' AND IDX_CTT_CD = 'S001'
            HAVING count(*) < 1
            UNION
            SELECT #{basicDate} as DLY_STRD_DT, 8 as SVC_ID, 'L093' as IDX_CL_GRP_CD, 'M001' as IDX_CL_CD, 'S001' as IDX_CTT_CD, count(*) as DLY_RSLT_VAL
            FROM   EISUSER.BPM_DLY_PRST
            WHERE  DLY_STRD_DT = #{basicDate}
            AND    SVC_ID = 8 AND IDX_CL_GRP_CD = 'L093' AND IDX_CL_CD = 'M001' AND IDX_CTT_CD = 'S001'
            HAVING count(*) < 1
            UNION
            SELECT dly_strd_dt, svc_id, idx_cl_grp_cd, idx_cl_cd, idx_ctt_cd, dly_rslt_val
            FROM   eisuser.bpm_dly_prst
            WHERE  dly_strd_dt = #{basicDate}
            AND    idx_cl_grp_cd in ('L091', 'L092', 'L093')
            AND    svc_id in (25, 8)
            AND    idx_cl_cd = 'M001'
            AND    idx_ctt_cd ='S001'
            UNION
            SELECT dly_strd_dt, svc_id, idx_cl_grp_cd, idx_cl_cd, idx_ctt_cd, dly_rslt_val
            FROM   eisuser.bpm_dly_prst
            WHERE  dly_strd_dt BETWEEN to_char(to_date(#{basicDate},'YYYYMMDD') - 30, 'YYYYMMDD') AND to_char(to_date(#{basicDate},'YYYYMMDD') - 1, 'YYYYMMDD')
            AND    idx_cl_grp_cd in ('L092')
            AND    svc_id in (25, 8)
            AND    idx_cl_cd = 'M001'
            AND    idx_ctt_cd ='S001'
            UNION
            SELECT dly_strd_dt, svc_id, idx_cl_grp_cd, idx_cl_cd, idx_ctt_cd, dly_rslt_val
            FROM   eisuser.bpm_dly_prst
            WHERE  dly_strd_dt BETWEEN SUBSTR(#{m3Day}, 1, 6)||'01' AND #{basicDate}
            AND    idx_cl_grp_cd in ('L091')
            AND    svc_id in (25, 8)
            AND    idx_cl_cd = 'M001'
            AND    idx_ctt_cd ='S001'
            UNION
            SELECT dly_strd_dt, svc_id, idx_cl_grp_cd, idx_cl_cd, idx_ctt_cd, dly_rslt_val
            FROM   eisuser.bpm_dly_prst
            WHERE  dly_strd_dt in (#{m1Day}, #{m2Day}, #{m3Day})
            AND    idx_cl_grp_cd in ('L093')
            AND    svc_id in (25, 8)
            AND    idx_cl_cd = 'M001'
            AND    idx_ctt_cd ='S001'
        )
        ORDER BY dly_strd_dt desc, svc_id desc, idx_cl_grp_cd asc
        ]]>
    </select>

    <select id="getBusinessDatas" parameterType="JqGridRequest" resultType="BpmDlyPrst">
        <![CDATA[
        SELECT dly_strd_dt, svc_id, idx_cl_grp_cd, idx_cl_cd, idx_ctt_cd, dly_rslt_val
        FROM (
            SELECT /*+ 11번가 */ #{basicDate} as DLY_STRD_DT, 11 as SVC_ID, 'L096' as IDX_CL_GRP_CD, 'M001' as IDX_CL_CD, 'S001' as IDX_CTT_CD, count(*) as DLY_RSLT_VAL
            FROM   EISUSER.BPM_DLY_PRST
            WHERE  DLY_STRD_DT = #{basicDate}
            AND    SVC_ID = 11 AND IDX_CL_GRP_CD = 'L096' AND IDX_CL_CD = 'M001' AND IDX_CTT_CD = 'S001'
            HAVING count(*) < 1
            UNION
            SELECT #{basicDate} as DLY_STRD_DT, 11 as SVC_ID, 'L097' as IDX_CL_GRP_CD, 'M001' as IDX_CL_CD, 'S001' as IDX_CTT_CD, count(*) as DLY_RSLT_VAL
            FROM   EISUSER.BPM_DLY_PRST
            WHERE  DLY_STRD_DT = #{basicDate}
            AND    SVC_ID = 11 AND IDX_CL_GRP_CD = 'L097' AND IDX_CL_CD = 'M001' AND IDX_CTT_CD = 'S001'
            HAVING count(*) < 1
            UNION
            SELECT #{basicDate} as DLY_STRD_DT, 11 as SVC_ID, 'L098' as IDX_CL_GRP_CD, 'M001' as IDX_CL_CD, 'S001' as IDX_CTT_CD, count(*) as DLY_RSLT_VAL
            FROM   EISUSER.BPM_DLY_PRST
            WHERE  DLY_STRD_DT = #{basicDate}
            AND    SVC_ID = 11 AND IDX_CL_GRP_CD = 'L098' AND IDX_CL_CD = 'M001' AND IDX_CTT_CD = 'S001'
            HAVING count(*) < 1
            UNION
            SELECT #{basicDate} as DLY_STRD_DT, 11 as SVC_ID, 'L099' as IDX_CL_GRP_CD, 'M001' as IDX_CL_CD, 'S001' as IDX_CTT_CD, count(*) as DLY_RSLT_VAL
            FROM   EISUSER.BPM_DLY_PRST
            WHERE  DLY_STRD_DT = #{basicDate}
            AND    SVC_ID = 11 AND IDX_CL_GRP_CD = 'L099' AND IDX_CL_CD = 'M001' AND IDX_CTT_CD = 'S001'
            HAVING count(*) < 1
            UNION
            SELECT #{basicDate} as DLY_STRD_DT, 11 as SVC_ID, 'L100' as IDX_CL_GRP_CD, 'M001' as IDX_CL_CD, 'S001' as IDX_CTT_CD, count(*) as DLY_RSLT_VAL
            FROM   EISUSER.BPM_DLY_PRST
            WHERE  DLY_STRD_DT = #{basicDate}
            AND    SVC_ID = 11 AND IDX_CL_GRP_CD = 'L100' AND IDX_CL_CD = 'M001' AND IDX_CTT_CD = 'S001'
            HAVING count(*) < 1
            UNION
            SELECT #{basicDate} as DLY_STRD_DT, 11 as SVC_ID, 'L101' as IDX_CL_GRP_CD, 'M001' as IDX_CL_CD, 'S001' as IDX_CTT_CD, count(*) as DLY_RSLT_VAL
            FROM   EISUSER.BPM_DLY_PRST
            WHERE  DLY_STRD_DT = #{basicDate}
            AND    SVC_ID = 11 AND IDX_CL_GRP_CD = 'L101' AND IDX_CL_CD = 'M001' AND IDX_CTT_CD = 'S001'
            HAVING count(*) < 1
            UNION
            SELECT dly_strd_dt, svc_id, idx_cl_grp_cd, idx_cl_cd, idx_ctt_cd, dly_rslt_val
            FROM   eisuser.bpm_dly_prst
            WHERE  dly_strd_dt = #{basicDate}
            AND    idx_cl_grp_cd in ('L096', 'L097', 'L098', 'L099', 'L100', 'L101')
            AND    svc_id in (11)
            AND    idx_cl_cd = 'M001'
            AND    idx_ctt_cd ='S001'
            UNION
            SELECT /*+ Tstore */ #{basicDate} as DLY_STRD_DT, 1 as SVC_ID, 'L102' as IDX_CL_GRP_CD, 'M001' as IDX_CL_CD, 'S001' as IDX_CTT_CD, count(*) as DLY_RSLT_VAL
            FROM   EISUSER.BPM_DLY_PRST
            WHERE  DLY_STRD_DT = #{basicDate}
            AND    SVC_ID = 1 AND IDX_CL_GRP_CD = 'L102' AND IDX_CL_CD = 'M001' AND IDX_CTT_CD = 'S001'
            HAVING count(*) < 1
            UNION
            SELECT #{basicDate} as DLY_STRD_DT, 1 as SVC_ID, 'L103' as IDX_CL_GRP_CD, 'M001' as IDX_CL_CD, 'S001' as IDX_CTT_CD, count(*) as DLY_RSLT_VAL
            FROM   EISUSER.BPM_DLY_PRST
            WHERE  DLY_STRD_DT = #{basicDate}
            AND    SVC_ID = 1 AND IDX_CL_GRP_CD = 'L103' AND IDX_CL_CD = 'M001' AND IDX_CTT_CD = 'S001'
            HAVING count(*) < 1
            UNION
            SELECT #{basicDate} as DLY_STRD_DT, 1 as SVC_ID, 'L104' as IDX_CL_GRP_CD, 'M001' as IDX_CL_CD, 'S001' as IDX_CTT_CD, count(*) as DLY_RSLT_VAL
            FROM   EISUSER.BPM_DLY_PRST
            WHERE  DLY_STRD_DT = #{basicDate}
            AND    SVC_ID = 1 AND IDX_CL_GRP_CD = 'L104' AND IDX_CL_CD = 'M001' AND IDX_CTT_CD = 'S001'
            HAVING count(*) < 1
            UNION
            SELECT #{basicDate} as DLY_STRD_DT, 1 as SVC_ID, 'L105' as IDX_CL_GRP_CD, 'M001' as IDX_CL_CD, 'S001' as IDX_CTT_CD, count(*) as DLY_RSLT_VAL
            FROM   EISUSER.BPM_DLY_PRST
            WHERE  DLY_STRD_DT = #{basicDate}
            AND    SVC_ID = 1 AND IDX_CL_GRP_CD = 'L105' AND IDX_CL_CD = 'M001' AND IDX_CTT_CD = 'S001'
            HAVING count(*) < 1
            UNION
            SELECT dly_strd_dt, svc_id, idx_cl_grp_cd, idx_cl_cd, idx_ctt_cd, dly_rslt_val
            FROM   eisuser.bpm_dly_prst
            WHERE  dly_strd_dt = #{basicDate}
            AND    idx_cl_grp_cd in ('L102', 'L103', 'L104', 'L105')
            AND    svc_id in (1)
            AND    idx_cl_cd = 'M001'
            AND    idx_ctt_cd ='S001'
            UNION
            SELECT /*+ Tmap */ #{basicDate} as DLY_STRD_DT, 4 as SVC_ID, 'L091' as IDX_CL_GRP_CD, 'M001' as IDX_CL_CD, 'S001' as IDX_CTT_CD, count(*) as DLY_RSLT_VAL
            FROM   EISUSER.BPM_DLY_PRST
            WHERE  DLY_STRD_DT = #{basicDate}
            AND    SVC_ID = 4 AND IDX_CL_GRP_CD = 'L091' AND IDX_CL_CD = 'M001' AND IDX_CTT_CD = 'S001'
            HAVING count(*) < 1
            UNION
            SELECT  #{basicDate} as DLY_STRD_DT, 4 as SVC_ID, 'L110' as IDX_CL_GRP_CD, 'M001' as IDX_CL_CD, 'S001' as IDX_CTT_CD, count(*) as DLY_RSLT_VAL
            FROM   EISUSER.BPM_DLY_PRST
            WHERE  DLY_STRD_DT = #{basicDate}
            AND    SVC_ID = 4 AND IDX_CL_GRP_CD = 'L110' AND IDX_CL_CD = 'M001' AND IDX_CTT_CD = 'S001'
            HAVING count(*) < 1
            UNION
            SELECT dly_strd_dt, svc_id, idx_cl_grp_cd, idx_cl_cd, idx_ctt_cd, dly_rslt_val
            FROM   eisuser.bpm_dly_prst
            WHERE  dly_strd_dt = #{basicDate}
            AND    idx_cl_grp_cd in ('L091', 'L110')
            AND    svc_id in (4)
            AND    idx_cl_cd = 'M001'
            AND    idx_ctt_cd ='S001'
            UNION
            SELECT /*+ Tcloud */ #{basicDate} as DLY_STRD_DT, 7 as SVC_ID, 'L017' as IDX_CL_GRP_CD, 'M001' as IDX_CL_CD, 'S001' as IDX_CTT_CD, count(*) as DLY_RSLT_VAL
            FROM   EISUSER.BPM_DLY_PRST
            WHERE  DLY_STRD_DT = #{basicDate}
            AND    SVC_ID = 7 AND IDX_CL_GRP_CD = 'L017' AND IDX_CL_CD = 'M001' AND IDX_CTT_CD = 'S001'
            HAVING count(*) < 1
            UNION
            SELECT  #{basicDate} as DLY_STRD_DT, 7 as SVC_ID, 'L081' as IDX_CL_GRP_CD, 'M001' as IDX_CL_CD, 'S001' as IDX_CTT_CD, count(*) as DLY_RSLT_VAL
            FROM   EISUSER.BPM_DLY_PRST
            WHERE  DLY_STRD_DT = #{basicDate}
            AND    SVC_ID = 7 AND IDX_CL_GRP_CD = 'L081' AND IDX_CL_CD = 'M001' AND IDX_CTT_CD = 'S001'
            HAVING count(*) < 1
            UNION
            SELECT dly_strd_dt, svc_id, idx_cl_grp_cd, idx_cl_cd, idx_ctt_cd, dly_rslt_val
            FROM   eisuser.bpm_dly_prst
            WHERE  dly_strd_dt = #{basicDate}
            AND    idx_cl_grp_cd in ('L017', 'L081')
            AND    svc_id in (7)
            AND    idx_cl_cd = 'M001'
            AND    idx_ctt_cd ='S001'
            UNION
            SELECT /*+ Hoppin */ #{basicDate} as DLY_STRD_DT, 6 as SVC_ID, 'L108' as IDX_CL_GRP_CD, 'M001' as IDX_CL_CD, 'S001' as IDX_CTT_CD, count(*) as DLY_RSLT_VAL
            FROM   EISUSER.BPM_DLY_PRST
            WHERE  DLY_STRD_DT = #{basicDate}
            AND    SVC_ID = 6 AND IDX_CL_GRP_CD = 'L108' AND IDX_CL_CD = 'M001' AND IDX_CTT_CD = 'S001'
            HAVING count(*) < 1
            UNION
            SELECT  #{basicDate} as DLY_STRD_DT, 6 as SVC_ID, 'L109' as IDX_CL_GRP_CD, 'M001' as IDX_CL_CD, 'S001' as IDX_CTT_CD, count(*) as DLY_RSLT_VAL
            FROM   EISUSER.BPM_DLY_PRST
            WHERE  DLY_STRD_DT = #{basicDate}
            AND    SVC_ID = 6 AND IDX_CL_GRP_CD = 'L109' AND IDX_CL_CD = 'M001' AND IDX_CTT_CD = 'S001'
            HAVING count(*) < 1
            UNION
            SELECT dly_strd_dt, svc_id, idx_cl_grp_cd, idx_cl_cd, idx_ctt_cd, dly_rslt_val
            FROM   eisuser.bpm_dly_prst
            WHERE  dly_strd_dt = #{basicDate}
            AND    idx_cl_grp_cd in ('L108', 'L109')
            AND    svc_id in (6)
            AND    idx_cl_cd = 'M001'
            AND    idx_ctt_cd ='S001'
            UNION
            SELECT dly_strd_dt, svc_id, idx_cl_grp_cd, idx_cl_cd, idx_ctt_cd, dly_rslt_val
            FROM   eisuser.bpm_dly_prst
            WHERE  dly_strd_dt between to_char(to_date(#{basicDate},'YYYYMMDD') - 30, 'YYYYMMDD') AND to_char(to_date(#{basicDate},'YYYYMMDD') - 1, 'YYYYMMDD')
            AND    idx_cl_grp_cd in ('L096', 'L098', 'L100')
            AND    svc_id in (11)
            AND    idx_cl_cd = 'M001'
            AND    idx_ctt_cd ='S001'
            UNION
            SELECT dly_strd_dt, svc_id, idx_cl_grp_cd, idx_cl_cd, idx_ctt_cd, dly_rslt_val
            FROM   eisuser.bpm_dly_prst
            WHERE  dly_strd_dt in (#{m1Day}, #{m2Day}, #{m3Day})
            AND    idx_cl_grp_cd in ('L097', 'L099', 'L101')
            AND    svc_id in (11)
            AND    idx_cl_cd = 'M001'
            AND    idx_ctt_cd ='S001'
            UNION
            SELECT dly_strd_dt, svc_id, idx_cl_grp_cd, idx_cl_cd, idx_ctt_cd, dly_rslt_val
            FROM   eisuser.bpm_dly_prst
            WHERE  dly_strd_dt between to_char(to_date(#{basicDate},'YYYYMMDD') - 30, 'YYYYMMDD') AND to_char(to_date(#{basicDate},'YYYYMMDD') - 1, 'YYYYMMDD')
            AND    idx_cl_grp_cd in ('L102', 'L104')
            AND    svc_id in (1)
            AND    idx_cl_cd = 'M001'
            AND    idx_ctt_cd ='S001'
            UNION
            SELECT dly_strd_dt, svc_id, idx_cl_grp_cd, idx_cl_cd, idx_ctt_cd, dly_rslt_val
            FROM   eisuser.bpm_dly_prst
            WHERE  dly_strd_dt in (#{m1Day}, #{m2Day}, #{m3Day})
            AND    idx_cl_grp_cd in ('L103', 'L105')
            AND    svc_id in (1)
            AND    idx_cl_cd = 'M001'
            AND    idx_ctt_cd ='S001'
            UNION
            SELECT dly_strd_dt, svc_id, idx_cl_grp_cd, idx_cl_cd, idx_ctt_cd, dly_rslt_val
            FROM   eisuser.bpm_dly_prst
            WHERE  dly_strd_dt between to_char(to_date(#{basicDate},'YYYYMMDD') - 30, 'YYYYMMDD') AND to_char(to_date(#{basicDate},'YYYYMMDD') - 1, 'YYYYMMDD')
            AND    idx_cl_grp_cd in ('L091')
            AND    svc_id in (4)
            AND    idx_cl_cd = 'M001'
            AND    idx_ctt_cd ='S001'
            UNION
            SELECT dly_strd_dt, svc_id, idx_cl_grp_cd, idx_cl_cd, idx_ctt_cd, dly_rslt_val
            FROM   eisuser.bpm_dly_prst
            WHERE  dly_strd_dt in (#{m1Day}, #{m2Day}, #{m3Day})
            AND    idx_cl_grp_cd in ('L110')
            AND    svc_id in (4)
            AND    idx_cl_cd = 'M001'
            AND    idx_ctt_cd ='S001'
            UNION
            SELECT dly_strd_dt, svc_id, idx_cl_grp_cd, idx_cl_cd, idx_ctt_cd, dly_rslt_val
            FROM   eisuser.bpm_dly_prst
            WHERE  dly_strd_dt between to_char(to_date(#{basicDate},'YYYYMMDD') - 30, 'YYYYMMDD') AND to_char(to_date(#{basicDate},'YYYYMMDD') - 1, 'YYYYMMDD')
            AND    idx_cl_grp_cd in ('L017')
            AND    svc_id in (7)
            AND    idx_cl_cd = 'M001'
            AND    idx_ctt_cd ='S001'
            UNION
            SELECT dly_strd_dt, svc_id, idx_cl_grp_cd, idx_cl_cd, idx_ctt_cd, dly_rslt_val
            FROM   eisuser.bpm_dly_prst
            WHERE  dly_strd_dt in (#{m1Day}, #{m2Day}, #{m3Day})
            AND    idx_cl_grp_cd in ('L081')
            AND    svc_id in (7)
            AND    idx_cl_cd = 'M001'
            AND    idx_ctt_cd ='S001'
            UNION
            SELECT dly_strd_dt, svc_id, idx_cl_grp_cd, idx_cl_cd, idx_ctt_cd, dly_rslt_val
            FROM   eisuser.bpm_dly_prst
            WHERE  dly_strd_dt between to_char(to_date(#{basicDate},'YYYYMMDD') - 30, 'YYYYMMDD') AND to_char(to_date(#{basicDate},'YYYYMMDD') - 1, 'YYYYMMDD')
            AND    idx_cl_grp_cd in ('L108')
            AND    svc_id in (6)
            AND    idx_cl_cd = 'M001'
            AND    idx_ctt_cd ='S001'
            UNION
            SELECT dly_strd_dt, svc_id, idx_cl_grp_cd, idx_cl_cd, idx_ctt_cd, dly_rslt_val
            FROM   eisuser.bpm_dly_prst
            WHERE  dly_strd_dt in (#{m1Day}, #{m2Day}, #{m3Day})
            AND    idx_cl_grp_cd in ('L109')
            AND    svc_id in (6)
            AND    idx_cl_cd = 'M001'
            AND    idx_ctt_cd ='S001'
        )
        ORDER BY dly_strd_dt desc, svc_id desc, idx_cl_grp_cd asc
        ]]>
    </select>

    <select id="getMailDatas" parameterType="JqGridRequest" resultType="BpmDlyPrst">
        SELECT /*+ OCB(유실적고객수, 거래건수, 거래액, 월누적 유실적고객수) */
               dly_strd_dt, svc_id, idx_cl_grp_cd, idx_cl_cd, idx_ctt_cd, audit_id, audit_dtm, dly_rslt_val
        FROM   eisuser.bpm_dly_prst
        WHERE  dly_strd_dt BETWEEN #{startDate} AND #{endDate}
        AND    idx_cl_grp_cd in ('L064', 'L072', 'L075', 'L090')
        AND    svc_id = 25
        AND    idx_cl_cd = 'M001'
        AND    idx_ctt_cd ='S001'
        UNION ALL /*+Syrup(신규가입자수, UV, 월누적UV) */
        SELECT dly_strd_dt, svc_id, idx_cl_grp_cd, idx_cl_cd, idx_ctt_cd, audit_id, audit_dtm, dly_rslt_val
        FROM   eisuser.bpm_dly_prst
        WHERE  dly_strd_dt BETWEEN #{startDate} AND #{endDate}
        AND    idx_cl_grp_cd in ('L001', 'L017', 'L081')
        AND    svc_id = 8
        AND    idx_cl_cd = 'M001'
        AND    idx_ctt_cd ='S001'
        UNION ALL /*+ Tstore(구매액, UV, 월누적UV) */
        SELECT dly_strd_dt, svc_id, idx_cl_grp_cd, idx_cl_cd, idx_ctt_cd, audit_id, audit_dtm, dly_rslt_val
        FROM   eisuser.bpm_dly_prst
        WHERE  dly_strd_dt BETWEEN #{startDate} AND #{endDate}
        AND    idx_cl_grp_cd in ('L023', 'L017', 'L081')
        AND    svc_id = 1
        AND    idx_cl_cd = 'M001'
        AND    idx_ctt_cd ='S001'
        UNION ALL /*+ Hoppin(매출액, UV, 월누적UV) */
        SELECT dly_strd_dt, svc_id, idx_cl_grp_cd, idx_cl_cd, idx_ctt_cd, audit_id, audit_dtm, dly_rslt_val
        FROM   eisuser.bpm_dly_prst
        WHERE  dly_strd_dt BETWEEN #{startDate} AND #{endDate}
        AND    idx_cl_grp_cd in ('L061', 'L017', 'L081')
        AND    svc_id = 6
        AND    idx_cl_cd = 'M001'
        AND    idx_ctt_cd ='S001'
        UNION ALL /*+ Tmap(신규가입자수, UV) */
        SELECT dly_strd_dt, svc_id, idx_cl_grp_cd, idx_cl_cd, idx_ctt_cd, audit_id, audit_dtm, dly_rslt_val
        FROM   eisuser.bpm_dly_prst
        WHERE  dly_strd_dt BETWEEN #{startDate} AND #{endDate}
        AND    idx_cl_grp_cd in ('L003', 'L017', 'L081')
        AND    svc_id = 4
        AND    idx_cl_cd = 'M001'
        AND    idx_ctt_cd ='S001'
        UNION ALL /*+ 11번가(구매회원수, 구매액, 직접방문률) */
        SELECT dly_strd_dt, svc_id, idx_cl_grp_cd, idx_cl_cd, idx_ctt_cd, audit_id, audit_dtm, dly_rslt_val
        FROM   eisuser.bpm_dly_prst
        WHERE  dly_strd_dt BETWEEN #{startDate} AND #{endDate}
        AND    idx_cl_grp_cd in ('L007','L023', 'L031')
        AND    svc_id = 11
        AND    idx_cl_cd = 'M001'
        AND    idx_ctt_cd ='S001'
        UNION ALL /*+ 11번가(월 직접방문율) */
        SELECT mth_stc_strd_ym as dlyStrdDt, svc_id, idx_cl_grp_cd, idx_cl_cd, idx_ctt_cd, audit_id, audit_dtm, mth_stc_rslt_val as dlyRsltVal
        FROM   eisuser.bpm_mth_stc_prst
        WHERE  mth_stc_strd_ym in (#{monthBeforeLast}, #{lastMonth})
        AND    idx_cl_grp_cd = 'L036'
        AND    svc_id = 11
        AND    idx_cl_cd = 'M001'
        AND    idx_ctt_cd ='S001'
        UNION ALL /*+ 11번가(월 구매회원수) */
        SELECT mth_stc_strd_ym as dlyStrdDt, svc_id, 'L086' as idx_cl_grp_cd, idx_cl_cd, idx_ctt_cd, audit_id, audit_dtm, mth_stc_rslt_val as dlyRsltVal
        FROM   eisuser.bpm_mth_stc_prst
        WHERE  mth_stc_strd_ym in (#{monthBeforeLast}, #{lastMonth})
        AND    idx_cl_grp_cd = 'L007'
        AND    svc_id = 11
        AND    idx_cl_cd = 'M001'
        AND    idx_ctt_cd ='S001'
        UNION ALL /*+ 11번가(월 구매액) */
        SELECT mth_stc_strd_ym as dlyStrdDt, svc_id, idx_cl_grp_cd, idx_cl_cd, idx_ctt_cd, audit_id, audit_dtm, mth_stc_rslt_val as dlyRsltVal
        FROM   eisuser.bpm_mth_stc_prst
        WHERE  mth_stc_strd_ym in (#{monthBeforeLast}, #{lastMonth})
        AND    idx_cl_grp_cd = 'L025'
        AND    svc_id = 11
        AND    idx_cl_cd = 'M001'
        AND    idx_ctt_cd ='S001'
        ORDER BY svc_id, idx_cl_grp_cd
    </select>

    <select id="getBpmMgntRsltScrnCmnts" parameterType="JqGridRequest" resultType="BpmMgntRsltScrnCmnt">
        SELECT stc_strd_dt, mgnt_rslt_scrn_cl_cd, cmnt_ctt, audit_id, audit_dtm
        FROM   eisuser.BPM_MGNT_RSLT_SCRN_CMNT
        WHERE  stc_strd_dt = #{basicDate}
        AND    mgnt_rslt_scrn_cl_cd in ('ocb', 'syrup', 'tstore', 'hoppin', 'tmap', 'sk11', 'ble', 'tcloud')
    </select>

    <select id="getBpmMgntEmailSndCtt" parameterType="BpmMgntEmailSndCtt" resultType="BpmMgntEmailSndCtt">
        SELECT snd_dtm, snd_obj_id, audit_id, audit_dtm, email_ctxt_ctt, email_snd_title_nm, snd_email_addr
        FROM   eisuser.bpm_mgnt_email_snd_ctt
        WHERE  snd_dtm = #{sndDtm}
        AND    snd_obj_id = #{sndObjId}
    </select>

    <select id="getBpmMgntEmailSndObj" parameterType="Long" resultType="BpmMgntEmailSndObj">
        SELECT snd_obj_id, audit_id, audit_dtm, email_type, email_template, email_snd_title_nm, snd_email_addr
        FROM   eisuser.bpm_mgnt_email_snd_obj
        WHERE  snd_obj_id = #{sndObjId}
    </select>

    <insert id="createBpmMgntRsltScrnCmnt" parameterType="BpmMgntRsltScrnCmnt">
       MERGE INTO EISUSER.BPM_MGNT_RSLT_SCRN_CMNT
       USING dual
         ON (stc_strd_dt = #{stcStrdDt} AND mgnt_rslt_scrn_cl_cd = #{mgntRsltScrnClCd})
       WHEN MATCHED THEN
         UPDATE SET audit_id = #{auditId:VARCHAR}
             ,audit_dtm = sysdate
             ,cmnt_ctt = #{cmntCtt}
         WHEN NOT MATCHED THEN
             INSERT (stc_strd_dt, mgnt_rslt_scrn_cl_cd, cmnt_ctt, audit_id, audit_dtm)
               VALUES (#{stcStrdDt}, #{mgntRsltScrnClCd}, #{cmntCtt}, #{auditId:VARCHAR}, sysdate)
    </insert>

    <insert id="createBpmMgntEmailSndUser" parameterType="BpmMgntEmailSndUser">
         INSERT INTO eisuser.bpm_mgnt_email_snd_user (login_id, snd_obj_id, audit_id, audit_dtm) VALUES
          (#{loginId}, #{sndObjId}, #{auditId}, sysdate)
    </insert>

    <insert id="createBpmMgntEmailSndCtt" parameterType="BpmMgntEmailSndCtt">
         INSERT INTO eisuser.bpm_mgnt_email_snd_ctt (snd_dtm, snd_obj_id, audit_id, audit_dtm, email_snd_title_nm, snd_email_addr, email_ctxt_ctt)
            VALUES (#{sndDtm}, #{sndObjId}, #{auditId}, sysdate, #{emailSndTitleNm}, #{sndEmailAddr}, #{emailCtxtCtt})
    </insert>

    <insert id="createBpmMgntEmailSndHistory" parameterType="BpmMgntEmailSndHistory">
        MERGE INTO eisuser.bpm_mgnt_email_snd_history
        USING dual
         ON (snd_dtm = #{sndDtm} AND snd_obj_id = #{sndObjId} AND rcv_id = #{rcvId})
        WHEN MATCHED THEN
         UPDATE SET audit_id = #{auditId:VARCHAR}
             ,rcv_email_addr = #{rcvEmailAddr}
             ,audit_dtm = sysdate
             ,snd_yn = #{sndYn}
         WHEN NOT MATCHED THEN
             INSERT (snd_dtm, snd_obj_id, rcv_id, rcv_email_addr, audit_id, snd_yn, audit_dtm)
               VALUES (#{sndDtm}, #{sndObjId}, #{rcvId}, #{rcvEmailAddr}, #{auditId}, #{sndYn}, sysdate)
    </insert>

    <update id="updateBpmMgntEmailSndCtt" parameterType="BpmMgntEmailSndCtt">
        UPDATE eisuser.bpm_mgnt_email_snd_ctt SET
            audit_id = #{auditId},
            audit_dtm = sysdate,
            email_snd_title_nm = #{emailSndTitleNm},
            snd_email_addr = #{sndEmailAddr},
            email_ctxt_ctt = #{emailCtxtCtt}
        WHERE  snd_dtm = #{sndDtm}
        AND    snd_obj_id = #{sndObjId}
    </update>

    <delete id="deleteBpmMgntEmailSndUser">
        DELETE FROM eisuser.bpm_mgnt_email_snd_user
        WHERE login_id in
        <foreach collection="array" item="item" index="index" separator="," open="(" close=")">
            #{item}
        </foreach>
        AND snd_obj_id = 1
    </delete>
    <delete id="deleteBpmMgntEmailSndUserForKid">
        DELETE FROM eisuser.bpm_mgnt_email_snd_user
        WHERE login_id in
        <foreach collection="array" item="item" index="index" separator="," open="(" close=")">
            #{item}
        </foreach>
        AND snd_obj_id = 3
    </delete>
</mapper>
