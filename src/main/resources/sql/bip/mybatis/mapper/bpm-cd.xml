<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skplanet.bisportal.repository.bip.BpmSvcCdRepository">
    <select id="getBpmSvcs" parameterType="WhereCondition" resultType="BpmSvcCd">
        SELECT
            a.SVC_ID SVC_CD_ID,
            SVC_NM SVC_CD_NM,
            NVL(DAY_YN,'N')||NVL(WEK_YN,'N')||NVL(MTH_YN,'N') AS SVC_CD_TITLE
        FROM EISUSER.COM_SVC a, EISUSER.BPM_SVC_PRT_SEQ_INFO b
            ,(SELECT A.SVC_ID
                ,MAX(CASE WHEN B.LNKG_CYCL_CD = 'D' THEN 'Y' END) DAY_YN
                ,MAX(CASE WHEN B.LNKG_CYCL_CD = 'W' THEN 'Y' END) WEK_YN
                ,MAX(CASE WHEN B.LNKG_CYCL_CD = 'M' THEN 'Y' END) MTH_YN
                FROM EISUSER.BPM_IDX_MGMT_INFO A
                    , EISUSER.BPM_IDX_CL_GRP_INFO B
                WHERE  A.IDX_CL_GRP_CD = B.IDX_CL_GRP_CD
                GROUP BY A.SVC_ID
            ) C
        WHERE  1=1
        AND a.SVC_ID = b.SVC_ID
        AND b.SVC_MGMT_YN = '1'
        AND a.SVC_ID = C.SVC_ID(+)
        ORDER BY PRT_PRTY_SEQ
    </select>

    <select id="getBpmCycleToGrps" parameterType="WhereCondition" resultType="BpmSvcCd">
        SELECT
            IDX_CL_GRP_CD SVC_CD_ID,
            IDX_CL_CD_GRP_NM SVC_CD_NM,
            IDX_CL_GRP_DESC SVC_CD_TITLE
        FROM EISUSER.BPM_IDX_CL_GRP_INFO
        WHERE IDX_CL_GRP_CD IN (SELECT DISTINCT(IDX_CL_GRP_CD)
                                FROM EISUSER.BPM_IDX_MGMT_INFO
                                WHERE SVC_ID = #{svcId})
            <if test="lnkgCyclCd != null">
                AND LNKG_CYCL_CD = #{lnkgCyclCd}
            </if>
        ORDER BY IDX_CL_GRP_CD
    </select>

    <select id="getBpmGrpToCls" parameterType="WhereCondition" resultType="BpmSvcCd">
        SELECT
            B.IDX_CL_CD SVC_CD_ID,
            B.IDX_CL_CD_VAL SVC_CD_NM,
            B.IDX_CL_CD_DESC SVC_CD_TITLE
        FROM EISUSER.BPM_IDX_CL_INFO  B
        WHERE B.IDX_CL_CD in (SELECT  DISTINCT(IDX_CL_CD)
                              FROM EISUSER.BPM_IDX_CTT_INFO
                              WHERE SVC_ID = #{svcId}
                              <if test="idxClGrpCd != null">
                                AND IDX_CL_GRP_CD = #{idxClGrpCd}
                              </if>)
        ORDER BY B.IDX_CL_CD
    </select>

    <select id="getBpmWkStrds" parameterType="String" resultType="BpmSvcCd">
        SELECT
            WK_STC_STRD_YMW SVC_CD_ID,
            WK_STRD_VAL SVC_CD_NM,
            CD_SEQ SVC_CD_TITLE
        FROM EISUSER.BPM_WK_STRD_INFO
        WHERE WK_STC_STRD_YMW like #{wkStcStrdYmw} || '%'
        ORDER BY WK_STC_STRD_YMW
    </select>
</mapper>
