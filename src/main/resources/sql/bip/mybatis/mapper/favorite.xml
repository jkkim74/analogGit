<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skplanet.bisportal.repository.bip.FavoriteRepository">
    <select id="getFavoritesByUsername" parameterType="String" resultType="Favorite">
        SELECT f.id, get_favorite_info(f.menu_id,'code',3) AS service_code,
                get_favorite_info(f.menu_id,'code',2) AS category_code,
                get_favorite_info(f.menu_id,'code',1) AS menu_code,
                get_favorite_info(f.menu_id,'name',3) AS service_name,
                get_favorite_info(f.menu_id,'name',2) AS category_name,
                get_favorite_info(f.menu_id,'name',1) AS menu_name,
                f.username, f.common_code_id, f.common_code_name
        FROM  favorite f, menu m
        WHERE f.username = #{username}
        AND   f.menu_id = m.id
        AND   m.delete_yn = 'N'
        ORDER BY m.order_idx, service_code, category_code, menu_code
    </select>
    <select id="getFavorite" parameterType="Favorite" resultType="Favorite">
        SELECT id, get_favorite_info(menu_id,'code',3) AS service_code,
                get_favorite_info(menu_id,'code',2) AS category_code,
                get_favorite_info(menu_id,'code',1) AS menu_code,
                get_favorite_info(menu_id,'name',3) AS service_name,
                get_favorite_info(menu_id,'name',2) AS category_name,
                get_favorite_info(menu_id,'name',1) AS menu_name,
                username, common_code_id, common_code_name
        FROM  favorite
        WHERE username = #{username}
        AND   common_code_name = #{commonCodeName}
        AND   menu_id = #{menuId}
    </select>
    <insert id="createFavorite" parameterType="Favorite">
        <selectKey keyProperty="id" order="BEFORE" resultType="Long">
            SELECT favorite_seq.nextval FROM DUAL
        </selectKey>
        INSERT INTO favorite (id, username, common_code_id, common_code_name, menu_id, last_update)
        VALUES (#{id}, #{username}, #{commonCodeId}, #{commonCodeName}, #{menuId}, #{lastUpdate})
    </insert>
    <select id="getFavoriteCountByCommonCodeIdMenuId" parameterType="Favorite" resultType="Integer">
        SELECT count(*) FROM favorite WHERE common_code_id = #{commonCodeId} AND menu_id = #{menuId}
    </select>
    <delete id="deleteFavorite" parameterType="Long">
        DELETE FROM favorite WHERE id = #{id}
    </delete>
    <delete id="deleteFavoriteByCommonCodeIdMenuId" parameterType="Favorite">
        DELETE FROM favorite WHERE common_code_id = #{commonCodeId} AND menu_id = #{menuId}
    </delete>
</mapper>
