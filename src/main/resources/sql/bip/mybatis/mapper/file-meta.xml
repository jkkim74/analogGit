<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skplanet.bisportal.repository.bip.HelpDeskRepository">

    <insert id="addFileMeta" parameterType="FileMeta">
        <selectKey keyProperty="id" resultType="long" order="BEFORE">
            select FILE_META_SEQ.nextval from dual
        </selectKey>
        INSERT INTO FILE_META (
            ID,
            CONTAINER_NAME,
            CONTENT_ID,
            CATEGORY,
            UUID,
            FILE_NAME,
            FILE_SIZE,
            CREATE_ID,
            CREATE_DATE
          )
        VALUES (
            ${id},
            #{containerName},
            #{contentId},
            #{category, jdbcType=VARCHAR},
            #{uuid},
            #{fileName},
            #{fileSize},
            #{createId},
            to_char(sysdate,'YYYYMMDDHH24MISS')
          )
    </insert>

    <select id="getFileMetaLists" parameterType="FileMeta" resultType="FileMeta">
        SELECT id AS id,
               container_name AS container_name,
               content_id AS content_id,
               category AS category,
               uuid AS uuid,
               file_name AS file_name,
               file_size AS file_size,
               create_id AS create_id,
               create_date AS create_date,
               update_id AS update_id,
               update_date AS update_date,
               delete_yn AS delete_yn
          FROM file_meta
         WHERE delete_yn = 'N'
           AND container_name = #{containerName}
           AND content_id = #{contentId}
    </select>

    <update id="deleteFile" parameterType="java.util.Map">
        UPDATE file_meta SET
            delete_YN = 'Y',
            update_id = #{updateId},
            update_date = to_char(sysdate,'YYYYMMDDHH24MISS')
        WHERE
            delete_yn = 'N'
            AND id in
            <foreach collection="fileMetaIdList" item="fileMetaId" separator="," open="(" close=")">
                #{fileMetaId}
            </foreach>
    </update>

    <update id="deleteFileByContentId" parameterType="java.util.Map">
        UPDATE file_meta SET
            delete_YN = 'Y',
            update_id = #{updateId},
            update_date = to_char(sysdate,'YYYYMMDDHH24MISS')
        WHERE
            delete_yn = 'N'
            AND content_id = #{contentId}
    </update>
</mapper>
