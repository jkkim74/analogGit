<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skplanet.ocbbi.pandora.repository.oracle.OracleRepository">

	<sql id="selectMembers_PAN0101">
		<choose>
			<when test="uploadProgress.columnName == 'OCBCOM_LGN_ID'">
				SELECT A.MBR_ID
					, DECODE(B.LGN_ID,NULL,B.LGN_ID,SUBSTR(B.LGN_ID,1,LENGTH(B.LGN_ID)-2)||'**') AS OCBCOM_LGN_ID
					, A.CI_NO
					, DECODE(A.MBR_KOR_NM,NULL,A.MBR_KOR_NM,SUBSTR(A.MBR_KOR_NM,1,LENGTH(A.MBR_KOR_NM)-2)||'*'||SUBSTR(A.MBR_KOR_NM,LENGTH(A.MBR_KOR_NM),1)) AS MBR_KOR_NM
					, DECODE(A.CARD_NO,NULL,A.CARD_NO,SUBSTR(A.CARD_NO,1,LENGTH(A.CARD_NO)-8)||'****'||SUBSTR(A.CARD_NO,LENGTH(A.CARD_NO)-3,4)) AS CARD_NO
					, A.SYW_MBR_ID
					, A.EVS_MBR_ID
				FROM MART_MBR_ID_MST A
				JOIN MART_OCBCOM_MBR_MST B ON A.MBR_ID = B.MBR_ID
				WHERE B.LGN_ID IN (SELECT COLUMN1 FROM TMP_${uploadProgress.pageId}_${uploadProgress.username})
			</when>
			<when test="uploadProgress.columnName == 'CARD_NO'">
				SELECT A.MBR_ID
				    , DECODE(A.OCBCOM_LGN_ID,NULL,A.OCBCOM_LGN_ID,SUBSTR(A.OCBCOM_LGN_ID,1,LENGTH(A.OCBCOM_LGN_ID)-2)||'**') AS OCBCOM_LGN_ID
					, A.CI_NO
					, DECODE(A.MBR_KOR_NM,NULL,A.MBR_KOR_NM,SUBSTR(A.MBR_KOR_NM,1,LENGTH(A.MBR_KOR_NM)-2)||'*'||SUBSTR(A.MBR_KOR_NM,LENGTH(A.MBR_KOR_NM),1)) AS MBR_KOR_NM
					, DECODE(B.CARD_NO,NULL,B.CARD_NO,SUBSTR(B.CARD_NO,1,LENGTH(B.CARD_NO)-8)||'****'||SUBSTR(B.CARD_NO,LENGTH(B.CARD_NO)-3,4)) AS CARD_NO
					, A.SYW_MBR_ID
					, A.EVS_MBR_ID
				FROM MART_MBR_ID_MST A
				JOIN MART_CARD_MST B ON A.MBR_ID = B.MBR_ID
				WHERE B.${uploadProgress.columnName} IN (SELECT COLUMN1 FROM TMP_${uploadProgress.pageId}_${uploadProgress.username})
			</when>
			<when test="uploadProgress.columnName == 'SYW_MBR_ID'">
				SELECT A.MBR_ID
					, DECODE(A.OCBCOM_LGN_ID,NULL,A.OCBCOM_LGN_ID,SUBSTR(A.OCBCOM_LGN_ID,1,LENGTH(A.OCBCOM_LGN_ID)-2)||'**') AS OCBCOM_LGN_ID
					, A.CI_NO
					, DECODE(A.MBR_KOR_NM,NULL,A.MBR_KOR_NM,SUBSTR(A.MBR_KOR_NM,1,LENGTH(A.MBR_KOR_NM)-2)||'*'||SUBSTR(A.MBR_KOR_NM,LENGTH(A.MBR_KOR_NM),1)) AS MBR_KOR_NM
					, DECODE(A.CARD_NO,NULL,A.CARD_NO,SUBSTR(A.CARD_NO,1,LENGTH(A.CARD_NO)-8)||'****'||SUBSTR(A.CARD_NO,LENGTH(A.CARD_NO)-3,4)) AS CARD_NO
					, B.SYW_MBR_ID
					, A.EVS_MBR_ID
				FROM MART_MBR_ID_MST A
				JOIN MART_SYW_MBR_ID_MST B ON A.MBR_ID = B.MBR_ID
				WHERE B.${uploadProgress.columnName} IN (SELECT COLUMN1 FROM TMP_${uploadProgress.pageId}_${uploadProgress.username})
			</when>
			<when test="uploadProgress.columnName == 'EVS_MBR_ID'">
				SELECT A.MBR_ID
					, DECODE(A.OCBCOM_LGN_ID,NULL,A.OCBCOM_LGN_ID,SUBSTR(A.OCBCOM_LGN_ID,1,LENGTH(A.OCBCOM_LGN_ID)-2)||'**') AS OCBCOM_LGN_ID
					, A.CI_NO
					, DECODE(A.MBR_KOR_NM,NULL,A.MBR_KOR_NM,SUBSTR(A.MBR_KOR_NM,1,LENGTH(A.MBR_KOR_NM)-2)||'*'||SUBSTR(A.MBR_KOR_NM,LENGTH(A.MBR_KOR_NM),1)) AS MBR_KOR_NM
					, DECODE(A.CARD_NO,NULL,A.CARD_NO,SUBSTR(A.CARD_NO,1,LENGTH(A.CARD_NO)-8)||'****'||SUBSTR(A.CARD_NO,LENGTH(A.CARD_NO)-3,4)) AS CARD_NO
					, A.SYW_MBR_ID
					, B.EVS_MBR_ID
				FROM MART_MBR_ID_MST A
				JOIN MART_EVS_MBR_ID_MST B ON A.MBR_ID = B.MBR_ID
				WHERE B.${uploadProgress.columnName} IN (SELECT COLUMN1 FROM TMP_${uploadProgress.pageId}_${uploadProgress.username})
			</when>
			<otherwise>
				SELECT MBR_ID
					, DECODE(OCBCOM_LGN_ID,NULL,OCBCOM_LGN_ID,SUBSTR(OCBCOM_LGN_ID,1,LENGTH(OCBCOM_LGN_ID)-2)||'**') AS OCBCOM_LGN_ID
					, CI_NO
					, DECODE(MBR_KOR_NM,NULL,MBR_KOR_NM,SUBSTR(MBR_KOR_NM,1,LENGTH(MBR_KOR_NM)-2)||'*'||SUBSTR(MBR_KOR_NM,LENGTH(MBR_KOR_NM),1)) AS MBR_KOR_NM
					, DECODE(CARD_NO,NULL,CARD_NO,SUBSTR(CARD_NO,1,LENGTH(CARD_NO)-8)||'****'||SUBSTR(CARD_NO,LENGTH(CARD_NO)-3,4)) AS CARD_NO
					, SYW_MBR_ID
					, EVS_MBR_ID
				FROM MART_MBR_ID_MST
				WHERE ${uploadProgress.columnName} IN (SELECT COLUMN1 FROM TMP_${uploadProgress.pageId}_${uploadProgress.username})
			</otherwise>
		</choose>
	</sql>
	
	<sql id="selectMembers_PAN0101_nomas">
		<choose>
			<when test="uploadProgress.columnName == 'OCBCOM_LGN_ID'">
				SELECT A.MBR_ID
					, B.LGN_ID AS OCBCOM_LGN_ID
					, A.CI_NO
					, A.MBR_KOR_NM AS MBR_KOR_NM
					, A.CARD_NO AS CARD_NO
					, A.SYW_MBR_ID
					, A.EVS_MBR_ID
				FROM MART_MBR_ID_MST A
				JOIN MART_OCBCOM_MBR_MST B ON A.MBR_ID = B.MBR_ID
				WHERE B.LGN_ID IN (SELECT COLUMN1 FROM TMP_${uploadProgress.pageId}_${uploadProgress.username})
			</when>
			<when test="uploadProgress.columnName == 'CARD_NO'">
				SELECT A.MBR_ID
				    , A.OCBCOM_LGN_ID AS OCBCOM_LGN_ID
					, A.CI_NO
					, A.MBR_KOR_NM AS MBR_KOR_NM
					, B.CARD_NO AS CARD_NO
					, A.SYW_MBR_ID
					, A.EVS_MBR_ID
				FROM MART_MBR_ID_MST A
				JOIN MART_CARD_MST B ON A.MBR_ID = B.MBR_ID
				WHERE B.${uploadProgress.columnName} IN (SELECT COLUMN1 FROM TMP_${uploadProgress.pageId}_${uploadProgress.username})
			</when>
			<when test="uploadProgress.columnName == 'SYW_MBR_ID'">
				SELECT A.MBR_ID
					, A.OCBCOM_LGN_ID AS OCBCOM_LGN_ID
					, A.CI_NO
					, A.MBR_KOR_NM AS MBR_KOR_NM
					, A.CARD_NO AS CARD_NO
					, B.SYW_MBR_ID
					, A.EVS_MBR_ID
				FROM MART_MBR_ID_MST A
				JOIN MART_SYW_MBR_ID_MST B ON A.MBR_ID = B.MBR_ID
				WHERE B.${uploadProgress.columnName} IN (SELECT COLUMN1 FROM TMP_${uploadProgress.pageId}_${uploadProgress.username})
			</when>
			<when test="uploadProgress.columnName == 'EVS_MBR_ID'">
				SELECT A.MBR_ID
					, A.OCBCOM_LGN_ID AS OCBCOM_LGN_ID
					, A.CI_NO
					, A.MBR_KOR_NM AS MBR_KOR_NM
					, A.CARD_NO AS CARD_NO
					, A.SYW_MBR_ID
					, B.EVS_MBR_ID
				FROM MART_MBR_ID_MST A
				JOIN MART_EVS_MBR_ID_MST B ON A.MBR_ID = B.MBR_ID
				WHERE B.${uploadProgress.columnName} IN (SELECT COLUMN1 FROM TMP_${uploadProgress.pageId}_${uploadProgress.username})
			</when>
			<otherwise>
				SELECT MBR_ID
					, OCBCOM_LGN_ID AS OCBCOM_LGN_ID
					, CI_NO
					, MBR_KOR_NM AS MBR_KOR_NM
					, CARD_NO AS CARD_NO
					, SYW_MBR_ID
					, EVS_MBR_ID
				FROM MART_MBR_ID_MST
				WHERE ${uploadProgress.columnName} IN (SELECT COLUMN1 FROM TMP_${uploadProgress.pageId}_${uploadProgress.username})
			</otherwise>
		</choose>
	</sql>	

</mapper>
