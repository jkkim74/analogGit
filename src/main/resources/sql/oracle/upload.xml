<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skplanet.pandora.repository.oracle.OracleRepository">

	<select id="countTable" parameterType="map" resultType="int">
		SELECT COUNT(*) FROM USER_TABLES WHERE TABLE_NAME = 'TMP_' || UPPER(#{pageId}) || '_' || UPPER(#{username})
	</select>
	<select id="countTable" parameterType="map" resultType="int" databaseId="hsql">
		SELECT 0 FROM DUAL
	</select>

	<update id="createTable" parameterType="map">
		CREATE TABLE TMP_${pageId}_${username} (
			COLUMN1 VARCHAR2(4000)
		)
		SEGMENT CREATION IMMEDIATE
		PCTFREE 10 PCTUSED 0 INITRANS 1 MAXTRANS 255
		NOCOMPRESS LOGGING
		STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
		PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
		BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
		TABLESPACE "INTG_DTBS_TDE"
	</update>
	<update id="createTable" parameterType="map" databaseId="hsql">
		CREATE TABLE IF NOT EXISTS TMP_${pageId}_${username} (
			COLUMN1 VARCHAR2(4000)
		)
	</update>

	<update id="truncateTable" parameterType="map">
		TRUNCATE TABLE TMP_${pageId}_${username}
	</update>

	<select id="selectUploadedPreview" parameterType="map" resultType="AutoMappedMap">
		SELECT *
		FROM (
			SELECT IN_SQ.*
			     , ROWNUM AS RNUM
			FROM ( SELECT * FROM TMP_${pageId}_${username} ) IN_SQ
			WHERE  ROWNUM &lt;= 100
		)
		WHERE RNUM &gt; 0
	</select>
	<select id="selectUploadedPreview" parameterType="map" resultType="AutoMappedMap" databaseId="hsql">
		SELECT * FROM TMP_${pageId}_${username}
		LIMIT 0, 100
	</select>
	
	<select id="countUploadedPreview" parameterType="map" resultType="int">
		SELECT COUNT(*) FROM TMP_${pageId}_${username}
	</select>

</mapper>
