<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skplanet.pandora.repository.oracle.OracleRepository">

	<select id="countTable" parameterType="map" resultType="int">
		SELECT COUNT(*) FROM USER_TABLES WHERE TABLE_NAME = 'TMP_' || UPPER(#{pageId}) || '_' || UPPER(#{username})
	</select>
	<select id="countTable" parameterType="map" resultType="int" databaseId="hsql">
		SELECT 0 FROM DUAL
	</select>

	<update id="createTable" parameterType="map">
		CREATE GLOBAL TEMPORARY TABLE TMP_${pageId}_${username} (
			COLUMN1 VARCHAR2(4000)
		) ON COMMIT PRESERVE ROWS
	</update>
	<update id="createTable" parameterType="map" databaseId="hsql">
        CREATE TABLE IF NOT EXISTS TMP_${pageId}_${username} (
            COLUMN1 VARCHAR2(4000)
        )
	</update>

	<update id="truncateTable" parameterType="map">
        TRUNCATE TABLE TMP_${pageId}_${username}
	</update>

	<insert id="insertBulk" parameterType="map">
		INSERT /*+ APPEND_VALUES */ ALL
		<foreach collection="bulkList" item="item" index="index" separator=" ">
			INTO TMP_${pageId}_${username} ( COLUMN1 ) VALUES ( #{item} )
		</foreach>
		SELECT * FROM DUAL
	</insert>
	<insert id="insertBulk" parameterType="map" databaseId="hsql">
		INSERT INTO TMP_${pageId}_${username} ( COLUMN1 ) VALUES 
		<foreach collection="bulkList" item="item" index="index" separator=",">
			 ( #{item} )
		</foreach>
	</insert>
	
	<insert id="insertUploadedData" parameterType="map">
	   INSERT INTO TMP_${pageId}_${username} ( COLUMN1 ) VALUES ( #{column1} ) 
	</insert>

    <select id="selectPreview" parameterType="map" resultType="AutoMappedMap">
        SELECT * FROM TMP_${pageId}_${username} LIMIT 1000
    </select>

</mapper>
