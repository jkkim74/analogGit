<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skplanet.ctas.repository.oracle.OracleRepository">

	<sql id="pagingHead">
		SELECT *
		FROM (
			SELECT IN_SQ.*, ROWNUM AS RNUM
			FROM (
	</sql>

	<sql id="pagingFoot">
			) IN_SQ
			WHERE ROWNUM &lt;= #{offset} + #{limit}
		)
		WHERE RNUM &gt; #{offset}
	</sql>
	<sql id="pagingFoot" databaseId="hsql">
		LIMIT #{offset}, #{limit}
	</sql>

	<select id="selectCampaigns" parameterType="map" resultType="AutoMappedMap">
		<include refid="pagingHead" />
		<include refid="selectCampaigns_inner" />
		<include refid="pagingFoot" />
	</select>
	<select id="selectCampaigns" parameterType="map" resultType="AutoMappedMap" databaseId="hsql">
		<include refid="selectCampaigns_inner" />
		<include refid="pagingFoot" />
	</select>
	
	<sql id="selectCampaigns_inner">
		SELECT CMPGN_ID
			, CMPGN_NM
			, TO_CHAR(TO_DATE(MERGE_DT, 'YYYYMMDD'), 'YYYY-MM-DD') AS MERGE_DT
			, TO_CHAR(TO_DATE(SND_DT, 'YYYYMMDD'), 'YYYY-MM-DD') AS SND_DT
			, OBJ_REG_FG_CD
			, TOT_CNT
			, DUP_DEL_CNT
			, CMPGN_SND_CHNL_FG_CD
			, CASE STS_FG_CD WHEN '01' THEN '머지완료' WHEN '02' THEN '전송완료' ELSE '' END AS STS_FG_NM
			, UPD_ID
		FROM WEB_CMPGN_MST
		<where>
			<if test="periodFrom != null and periodFrom != ''">AND SND_DT &gt;= #{periodFrom}</if>
			<if test="periodTo != null and periodTo != ''">AND SND_DT &lt;= #{periodTo}</if>
		</where>
	</sql>

	<select id="countCampaigns" parameterType="map" resultType="int">
		SELECT COUNT(*) FROM (
			<include refid="selectCampaigns_inner" />
		)
	</select>

</mapper>
